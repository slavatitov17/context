// Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ API-Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Mistral AI Ğ¸ PlantUML
import { NextRequest, NextResponse } from 'next/server';
import { Mistral } from '@mistralai/mistralai';
import { readFileSync } from 'fs';
import { join } from 'path';

// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Mistral AI ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°
function getMistralClient(): Mistral | null {
  const apiKey = process.env.MISTRAL_API_KEY;
  if (!apiKey) {
    return null;
  }
  return new Mistral({ apiKey });
}

// Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
function getContextFromDocuments(documents: any[]): string {
  const allChunks: string[] = [];
  documents.forEach((doc: any) => {
    if (doc.chunks && Array.isArray(doc.chunks)) {
      allChunks.push(...doc.chunks);
    } else if (doc.text) {
      const chunkSize = 1000;
      for (let i = 0; i < doc.text.length; i += chunkSize) {
        allChunks.push(doc.text.substring(i, i + chunkSize));
      }
    }
  });
  return allChunks.join('\n\n---\n\n');
}

const XSI_NS = 'http://www.w3.org/2001/XMLSchema-instance';

/** Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ BPMN XML Ğ¾Ñ‚ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸: xsi namespace, incoming/outgoing Ñƒ ÑˆĞ»ÑĞ·Ğ¾Ğ², Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ğµ sequenceFlow. */
function fixBpmnXml(xml: string): string {
  let out = xml;

  // Ğ•ÑĞ»Ğ¸ Ğ² XML ĞµÑÑ‚ÑŒ xsi:type (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ² conditionExpression), Ğ½Ğ¾ Ğ½ĞµÑ‚ xmlns:xsi â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼
  if (/xsi:type\b/i.test(out) && !/xmlns:xsi\s*=/i.test(out)) {
    out = out.replace(
      /(<bpmn:definitions)(\s[^>]*)?>/i,
      (_, tag, rest) => `${tag}${rest || ''} xmlns:xsi="${XSI_NS}" >`
    );
  }

  // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ñ‹ incoming Ğ¸ outgoing Ñƒ ÑˆĞ»ÑĞ·Ğ¾Ğ² (bpmn-js ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ Ğ³Ñ€Ğ°Ñ„ Ğ¿Ğ¾ sequenceFlow)
  out = out.replace(
    /(<bpmn:(?:exclusive|parallel)Gateway[^>]*)\s+incoming="[^"]*"/gi,
    '$1'
  );
  out = out.replace(
    /(<bpmn:(?:exclusive|parallel)Gateway[^>]*)\s+outgoing="[^"]*"/gi,
    '$1'
  );

  const processMatch = out.match(/<bpmn:process[^>]*>([\s\S]*?)<\/bpmn:process>/);
  if (!processMatch) return out;

  let processBody = processMatch[1];
  const processOpen = out.substring(0, out.indexOf(processMatch[0]) + processMatch[0].indexOf('>') + 1);
  const processClose = '</bpmn:process>';
  const afterProcess = out.substring(out.indexOf(processClose) + processClose.length);

  const targetRefs = new Set<string>();
  const sourceRefs = new Set<string>();
  const flowIds = new Set<string>();
  for (const m of processBody.matchAll(/<bpmn:sequenceFlow[^>]*\ssourceRef="([^"]*)"[^>]*\stargetRef="([^"]*)"/gi)) {
    sourceRefs.add(m[1]);
    targetRefs.add(m[2]);
  }
  for (const m of processBody.matchAll(/<bpmn:sequenceFlow[^>]*\stargetRef="([^"]*)"[^>]*\ssourceRef="([^"]*)"/gi)) {
    sourceRefs.add(m[2]);
    targetRefs.add(m[1]);
  }
  for (const m of processBody.matchAll(/<bpmn:sequenceFlow[^>]*\sid="([^"]+)"/gi)) {
    flowIds.add(m[1]);
  }

  const startIds: string[] = [];
  const endIds: string[] = [];
  const gatewayIds: string[] = [];
  const taskIds: string[] = [];
  for (const m of processBody.matchAll(/<bpmn:startEvent[^>]*\sid="([^"]+)"/gi)) startIds.push(m[1]);
  for (const m of processBody.matchAll(/<bpmn:endEvent[^>]*\sid="([^"]+)"/gi)) endIds.push(m[1]);
  for (const m of processBody.matchAll(/<bpmn:(?:exclusive|parallel)Gateway[^>]*\sid="([^"]+)"/gi)) gatewayIds.push(m[1]);
  for (const m of processBody.matchAll(/<bpmn:task[^>]*\sid="([^"]+)"/gi)) taskIds.push(m[1]);

  const gatewaysWithoutIncoming = gatewayIds.filter((id) => !targetRefs.has(id));
  const tasksWithoutOutgoing = taskIds.filter((id) => !sourceRefs.has(id));
  const tasksWithoutIncoming = taskIds.filter((id) => !targetRefs.has(id));
  const gatewaysWithoutOutgoing = gatewayIds.filter((id) => !sourceRefs.has(id));
  const endsWithoutIncoming = endIds.filter((id) => !targetRefs.has(id));

  const newFlows: string[] = [];
  const usedFlowIds = new Set(flowIds);
  const genFlowId = (src: string, tgt: string): string => {
    let id = `Flow_${src}_${tgt}`;
    let n = 0;
    while (usedFlowIds.has(id)) id = `Flow_fix_${++n}`;
    usedFlowIds.add(id);
    return id;
  };

  const startId = startIds[0];
  const endId = endIds[0];

  for (let i = 0; i < Math.min(tasksWithoutOutgoing.length, gatewaysWithoutIncoming.length); i++) {
    const src = tasksWithoutOutgoing[i];
    const tgt = gatewaysWithoutIncoming[i];
    newFlows.push(`<bpmn:sequenceFlow id="${genFlowId(src, tgt)}" sourceRef="${src}" targetRef="${tgt}"/>`);
    sourceRefs.add(src);
    targetRefs.add(tgt);
  }
  const remainingGatewaysNoIn = gatewaysWithoutIncoming.slice(tasksWithoutOutgoing.length);
  const remainingTasksNoOut = tasksWithoutOutgoing.slice(gatewaysWithoutIncoming.length);

  if (startId) {
    for (const tgt of remainingGatewaysNoIn) {
      newFlows.push(`<bpmn:sequenceFlow id="${genFlowId(startId, tgt)}" sourceRef="${startId}" targetRef="${tgt}"/>`);
      targetRefs.add(tgt);
    }
  }

  if (endId) {
    for (const src of remainingTasksNoOut) {
      newFlows.push(`<bpmn:sequenceFlow id="${genFlowId(src, endId)}" sourceRef="${src}" targetRef="${endId}"/>`);
      sourceRefs.add(src);
      targetRefs.add(endId);
    }
  }

  if (startId) {
    for (const tgt of tasksWithoutIncoming) {
      if (!targetRefs.has(tgt)) {
        newFlows.push(`<bpmn:sequenceFlow id="${genFlowId(startId, tgt)}" sourceRef="${startId}" targetRef="${tgt}"/>`);
        targetRefs.add(tgt);
      }
    }
  }

  if (endId) {
    for (const src of gatewaysWithoutOutgoing) {
      if (!sourceRefs.has(src)) {
        newFlows.push(`<bpmn:sequenceFlow id="${genFlowId(src, endId)}" sourceRef="${src}" targetRef="${endId}"/>`);
        sourceRefs.add(src);
      }
    }
  }

  const anySource = [...taskIds, ...gatewayIds, ...startIds].find((id) => sourceRefs.has(id)) || startId;
  if (anySource) {
    for (const tgt of endsWithoutIncoming) {
      if (!targetRefs.has(tgt)) {
        newFlows.push(`<bpmn:sequenceFlow id="${genFlowId(anySource, tgt)}" sourceRef="${anySource}" targetRef="${tgt}"/>`);
        targetRefs.add(tgt);
      }
    }
  }

  if (newFlows.length === 0) return out;
  const newFlowBlock = '\n    ' + newFlows.join('\n    ') + '\n  ';
  const newProcessBody = processBody.trimEnd() + newFlowBlock;
  return processOpen + newProcessBody + processClose + afterProcess;
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();
    const { diagramType, objectDescription, documents, isFromProject } = body;

    if (!diagramType || typeof diagramType !== 'string') {
      return NextResponse.json(
        { error: 'Ğ¢Ğ¸Ğ¿ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½' },
        { status: 400 }
      );
    }

    if (!objectDescription || typeof objectDescription !== 'string') {
      return NextResponse.json(
        { error: 'ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ° Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¾' },
        { status: 400 }
      );
    }

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ Mistral AI
    const client = getMistralClient();

    if (!client) {
      return NextResponse.json(
        { error: 'Mistral AI API ĞºĞ»ÑÑ‡ Ğ½Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ MISTRAL_API_KEY Ğ² Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ.' },
        { status: 500 }
      );
    }

    // Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
    let context = '';
    if (isFromProject && documents && Array.isArray(documents) && documents.length > 0) {
      context = getContextFromDocuments(documents);
    }

    // BPMN: Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµĞ¼ BPMN 2.0 XML
    if (diagramType === 'BPMN') {
      let bpmnInstructions = '';
      try {
        const instructionsPath = join(process.cwd(), 'prompts', 'bpmn-instructions.md');
        bpmnInstructions = readFileSync(instructionsPath, 'utf-8');
      } catch (e) {
        console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ñ‡Ñ‚ĞµĞ½Ğ¸Ñ bpmn-instructions.md:', e);
        bpmnInstructions = 'Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ BPMN 2.0 XML Ñ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ¼ (bpmn:process), startEvent, endEvent, task, sequenceFlow Ñ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¼Ğ¸ sourceRef Ğ¸ targetRef. Ğ’ÑĞµ name Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼.';
      }
      const systemPromptBpmn = `Ğ¢Ñ‹ ÑĞºÑĞ¿ĞµÑ€Ñ‚ Ğ¿Ğ¾ BPMN 2.0. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ BPMN 2.0 XML Ğ¸ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹. Ğ‘ĞµĞ· Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸Ğ¹ Ğ²Ğ½Ğµ Ğ±Ğ»Ğ¾ĞºĞ¾Ğ². ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾: Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğ¹ (Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ´Ğ°Ñ‡, ÑˆĞ»ÑĞ·Ñ‹, Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ), Ğ¸ Ñƒ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ ÑĞ²ÑĞ·Ğ¸: Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑˆĞ»ÑĞ·Ğ° â€” Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ sequenceFlow (targetRef=id ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°) Ğ¸ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğ¹ sequenceFlow (sourceRef=id ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°). Ğ¡Ñ‚Ğ°Ñ€Ñ‚ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸ÑÑ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ, ĞºĞ¾Ğ½Ñ†Ñ‹ â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ. ĞÑ‚Ğ²ĞµÑ‚: Ğ¾Ğ´Ğ¸Ğ½ Ğ±Ğ»Ğ¾Ğº \`\`\`xml Ğ¸Ğ»Ğ¸ \`\`\`bpmn Ñ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¼ BPMN 2.0 XML (bpmn:definitions, Ğ¾Ğ´Ğ¸Ğ½ bpmn:process, ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ id, name Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼, Ğ²ÑĞµ sourceRef/targetRef ÑĞ¾Ğ²Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ñ id ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²). Ğ—Ğ°Ñ‚ĞµĞ¼ Ğ±Ğ»Ğ¾Ğº \`\`\`json Ñ Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ¾Ğ¼ [{"element": "Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", "description": "Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ"}].`;
      const contextLimit = isFromProject && context ? 8000 : 0;
      const userPromptBpmn = `ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°:\n\n${objectDescription}\n\n${bpmnInstructions}${context && contextLimit ? `\n\nĞ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° (ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ğ¹ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹):\n${context.substring(0, contextLimit)}` : ''}\n\nĞ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ BPMN 2.0 XML ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ ÑĞ²ÑĞ·ÑĞ¼Ğ¸ (sequenceFlow) Ğ¼ĞµĞ¶Ğ´Ñƒ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ Ğ² ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ.`;
      const chatResponse = await client.chat.complete({
        model: 'pixtral-12b-2409',
        messages: [
          { role: 'system', content: systemPromptBpmn },
          { role: 'user', content: userPromptBpmn },
        ],
        maxTokens: 8192,
        temperature: 0.25,
      });
      const responseContent = chatResponse.choices?.[0]?.message?.content;
      let responseText = '';
      if (typeof responseContent === 'string') responseText = responseContent;
      else if (Array.isArray(responseContent)) {
        responseText = responseContent.map((c: any) => typeof c === 'string' ? c : ('text' in c && typeof c.text === 'string' ? c.text : '')).join('');
      } else responseText = String(responseContent || '');
      const xmlMatch = responseText.match(/```(?:xml|bpmn)\s*\n([\s\S]*?)\n```/i) || responseText.match(/(<\?xml[\s\S]*?<\/bpmn:definitions>)/i);
      let bpmnXml = xmlMatch ? (xmlMatch[1] || xmlMatch[0]).trim() : '';
      if (bpmnXml && !bpmnXml.startsWith('<?xml')) bpmnXml = '<?xml version="1.0" encoding="UTF-8"?>\n' + bpmnXml;
      const glossaryMatch = responseText.match(/```json\s*\n([\s\S]*?)\n```/i);
      let glossary: Array<{ element: string; description: string }> = [];
      if (glossaryMatch) {
        try {
          glossary = JSON.parse(glossaryMatch[1]);
        } catch (_) {
          glossary = [];
        }
      }
      if (!Array.isArray(glossary)) glossary = [];
      if (!bpmnXml) {
        bpmnXml = `<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:process id="Process_1" isExecutable="false">
    <bpmn:startEvent id="StartEvent_1" name="ĞĞ°Ñ‡Ğ°Ğ»Ğ¾"/>
    <bpmn:task id="Task_1" name="Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°"/>
    <bpmn:endEvent id="EndEvent_1" name="ĞšĞ¾Ğ½ĞµÑ†"/>
    <bpmn:sequenceFlow id="Flow_1" sourceRef="StartEvent_1" targetRef="Task_1"/>
    <bpmn:sequenceFlow id="Flow_2" sourceRef="Task_1" targetRef="EndEvent_1"/>
  </bpmn:process>
</bpmn:definitions>`;
      }
      bpmnXml = fixBpmnXml(bpmnXml);
      return NextResponse.json({ bpmnXml, glossary });
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ ÑÑ‚Ğ¾ Mermaid Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¾Ğ¹
    const isMermaid = diagramType === 'MindMapMermaid' || 
                      diagramType === 'MindMapMax' ||
                      diagramType === 'SequenceMermaid' ||
                      diagramType === 'ClassMermaid' ||
                      diagramType === 'StateMermaid' ||
                      diagramType === 'ActivityMermaid' ||
                      diagramType === 'ActivityMax' ||
                      diagramType === 'GanttMermaid' ||
                      diagramType === 'ERMermaid' ||
                      diagramType === 'Architecture' ||
                      diagramType === 'C4' ||
                      diagramType === 'Git' ||
                      diagramType === 'Kanban' ||
                      diagramType === 'Pie' ||
                      diagramType === 'Quadrant' ||
                      diagramType === 'Radar' ||
                      diagramType === 'UserJourney' ||
                      diagramType === 'XY';

    // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ñ‚Ğ¸Ğ¿ Mermaid Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
    const getMermaidDiagramType = (type: string): string => {
      if (type === 'MindMapMermaid' || type === 'MindMapMax') return 'mindmap';
      if (type === 'SequenceMermaid') return 'sequenceDiagram';
      if (type === 'ClassMermaid') return 'classDiagram';
      if (type === 'StateMermaid') return 'stateDiagram-v2';
      if (type === 'ActivityMermaid' || type === 'ActivityMax') return 'flowchart';
      if (type === 'GanttMermaid') return 'gantt';
      if (type === 'ERMermaid') return 'erDiagram';
      if (type === 'Architecture') return 'graph';
      if (type === 'C4') return 'C4Context';
      if (type === 'Git') return 'gitGraph';
      if (type === 'Kanban') return 'kanban';
      if (type === 'Pie') return 'pie';
      if (type === 'Quadrant') return 'quadrantChart';
      if (type === 'Radar') return 'radar';
      if (type === 'UserJourney') return 'journey';
      if (type === 'XY') return 'xychart-beta';
      return 'mindmap';
    };

    // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ¿Ğ¾ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑÑƒ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
    const getMermaidSyntaxInstructions = (type: string, diagramType: string): string => {
      // Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ ActivityMax
      if (type === 'ActivityMax') {
        return `ğŸš¨ğŸš¨ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ Ğ”Ğ›Ğ¯ ACTIVITY - Ğ§Ğ˜Ğ¢ĞĞ™ Ğ’ĞĞ˜ĞœĞĞ¢Ğ•Ğ›Ğ¬ĞĞ! ğŸš¨ğŸš¨ğŸš¨

Ğ¢Ğ« Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬ ĞĞ‘Ğ¡ĞĞ›Ğ®Ğ¢ĞĞ ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ™ ĞšĞĞ” FLOWCHART Ğ‘Ğ•Ğ— ĞĞ¨Ğ˜Ğ‘ĞĞš!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #1: Ğ¡Ğ˜ĞĞ¢ĞĞšĞ¡Ğ˜Ğ¡ - Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞŸĞ•Ğ Ğ’ĞĞ¯ Ğ¡Ğ¢Ğ ĞĞšĞ ĞšĞĞ”Ğ: Ğ¢ĞĞ§ĞĞ "flowchart TD" Ğ¸Ğ»Ğ¸ "flowchart LR" Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞ’, Ğ‘Ğ•Ğ— ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ’!
- ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: "  flowchart TD" Ğ¸Ğ»Ğ¸ "\\n  flowchart TD" Ğ¸Ğ»Ğ¸ " flowchart TD"
- ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: "flowchart TD" (Ğ½Ğ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ, Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ!)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #2: ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ« - Ğ­Ğ¢Ğ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ! Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ¥ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ’ ĞšĞĞ” ĞĞ• Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ™ Ğ¢ĞĞ›Ğ¬ĞšĞ ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ«! ĞĞ˜ĞšĞĞ“Ğ”Ğ ĞĞ• Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ™ Ğ¢ĞĞ‘Ğ£Ğ›Ğ¯Ğ¦Ğ˜Ğ® (TAB)!
- Ğ¡Ğ¢Ğ ĞĞšĞ 1: "flowchart TD" (0 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²)
- Ğ¡Ğ¢Ğ ĞĞšĞ 2+: Ğ²ÑĞµ ÑƒĞ·Ğ»Ñ‹ Ğ¸ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ñ Ğ ĞĞ’ĞĞ 4 ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞœĞ˜ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°
- Ğ”Ğ»Ñ Ğ¿Ğ¾Ğ´Ğ³Ñ€Ğ°Ñ„Ğ¾Ğ²: +2 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ Ğº Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ¾Ğ¼Ñƒ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñƒ

Ğ¡Ğ¢Ğ ĞĞ“ĞĞ¯ Ğ¡Ğ¥Ğ•ĞœĞ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ’:
flowchart TD                    â† 0 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²
    A[ĞĞ°Ñ‡Ğ°Ğ»Ğ¾]                   â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ!)
    B{Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ?}                â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°
    A --> B                     â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°
    B -->|Ğ”Ğ°| C[Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ 1]     â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°
    B -->|ĞĞµÑ‚| D[Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ 2]     â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°

ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ (Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ!):
flowchart TD
  A[ĞĞ°Ñ‡Ğ°Ğ»Ğ¾]                     â† ĞĞ•Ğ¢ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ! ĞĞ¨Ğ˜Ğ‘ĞšĞ!
    B{Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ?}                 â† ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
A --> B                          â† ĞĞ•Ğ¢ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ! ĞĞ¨Ğ˜Ğ‘ĞšĞ!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #3: Ğ¤ĞĞ ĞœĞĞ¢Ğ« Ğ£Ğ—Ğ›ĞĞ’ - Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ™ ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ•!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞŸÑ€Ğ¾Ñ†ĞµÑÑÑ‹/Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ: A[Ğ¢ĞµĞºÑÑ‚]
- Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ/Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ: B{Ğ¢ĞµĞºÑÑ‚?}
- ĞĞ°Ñ‡Ğ°Ğ»Ğ¾/ĞºĞ¾Ğ½ĞµÑ†: C((Ğ¢ĞµĞºÑÑ‚))
- Ğ’Ğ²Ğ¾Ğ´/Ğ²Ñ‹Ğ²Ğ¾Ğ´: D[/Ğ¢ĞµĞºÑÑ‚/] Ğ¸Ğ»Ğ¸ E[\\Ğ¢ĞµĞºÑÑ‚\\]

ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ:
flowchart TD
    Start((ĞĞ°Ñ‡Ğ°Ğ»Ğ¾))
    Input[/Ğ’Ğ²Ğ¾Ğ´ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…/]
    Process[ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°]
    Decision{Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾?}
    Output[\\Ğ’Ñ‹Ğ²Ğ¾Ğ´\\]
    End((ĞšĞ¾Ğ½ĞµÑ†))

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #4: Ğ¡Ğ¢Ğ Ğ•Ğ›ĞšĞ˜ - Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ™ ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ•!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞĞ±Ñ‹Ñ‡Ğ½Ğ°Ñ ÑÑ‚Ñ€ĞµĞ»ĞºĞ°: A --> B
- Ğ¡ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼: A -->|Ğ¢ĞµĞºÑÑ‚| B
- Ğ¢Ğ¾Ğ»ÑÑ‚Ğ°Ñ: A ==> B
- ĞŸÑƒĞ½ĞºÑ‚Ğ¸Ñ€Ğ½Ğ°Ñ: A -.-> B

ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ:
flowchart TD
    A[Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ 1]
    B{Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ?}
    C[Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ 2]
    A --> B
    B -->|Ğ”Ğ°| C
    B -->|ĞĞµÑ‚| A

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #5: Ğ’Ğ¡Ğ• Ğ¡ĞšĞĞ‘ĞšĞ˜ Ğ”ĞĞ›Ğ–ĞĞ« Ğ‘Ğ«Ğ¢Ğ¬ Ğ—ĞĞšĞ Ğ«Ğ¢Ğ«!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞšĞ°Ğ¶Ğ´Ğ°Ñ [ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¸Ğ¼ĞµÑ‚ÑŒ ]
- ĞšĞ°Ğ¶Ğ´Ğ°Ñ { Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¸Ğ¼ĞµÑ‚ÑŒ }
- ĞšĞ°Ğ¶Ğ´Ğ°Ñ ( Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ¸Ğ¼ĞµÑ‚ÑŒ )
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ subgraph Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¸Ğ¼ĞµÑ‚ÑŒ end

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #6: Ğ Ğ£Ğ¡Ğ¡ĞšĞ˜Ğ™ Ğ¯Ğ—Ğ«Ğš!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ÑƒĞ·Ğ»Ğ¾Ğ² Ğ½Ğ° Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ ÑĞ·Ñ‹ĞºĞµ
- Ğ’ĞµÑÑŒ Ñ‚ĞµĞºÑÑ‚ Ğ½Ğ° ÑÑ‚Ñ€ĞµĞ»ĞºĞ°Ñ… Ğ½Ğ° Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ ÑĞ·Ñ‹ĞºĞµ
- Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ Mermaid Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞ“Ğ ĞšĞĞ”Ğ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1 (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹):
flowchart TD
    Start((ĞĞ°Ñ‡Ğ°Ğ»Ğ¾))
    Input[/Ğ’Ğ²Ğ¾Ğ´ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…/]
    Process[ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°]
    Decision{Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾?}
    Output[\\Ğ’Ñ‹Ğ²Ğ¾Ğ´\\]
    End((ĞšĞ¾Ğ½ĞµÑ†))
    
    Start --> Input
    Input --> Process
    Process --> Decision
    Decision -->|Ğ”Ğ°| Output
    Decision -->|ĞĞµÑ‚| Process
    Output --> End

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2 (Ñ Ğ¿Ğ¾Ğ´Ğ³Ñ€Ğ°Ñ„Ğ°Ğ¼Ğ¸):
flowchart TD
    Start((ĞĞ°Ñ‡Ğ°Ğ»Ğ¾))
    
    subgraph ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° ["Ğ­Ñ‚Ğ°Ğ¿ Ğ¿Ğ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ¸"]
        A1[Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…]
        A2[Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ]
        A1 --> A2
    end
    
    subgraph ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ["Ğ­Ñ‚Ğ°Ğ¿ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸"]
        B1[ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°]
        B2[Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ]
        B1 --> B2
    end
    
    Start --> A1
    A2 --> B1
    B2 --> End((ĞšĞ¾Ğ½ĞµÑ†))

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ§Ğ•ĞšĞ›Ğ˜Ğ¡Ğ¢ ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™ - ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬ ĞšĞĞ–Ğ”Ğ«Ğ™ ĞŸĞ£ĞĞšĞ¢! ğŸš¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Ğ¡Ğ¢Ğ ĞĞšĞ 1: "flowchart TD" Ğ¸Ğ»Ğ¸ "flowchart LR" Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞ’?
âœ… Ğ’ÑĞµ ÑƒĞ·Ğ»Ñ‹ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ Ğ ĞĞ’ĞĞ 4 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ?
âœ… Ğ’ÑĞµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹ ([], {}, ())?
âœ… Ğ’ÑĞµ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ñ‹ (-->)?
âœ… ĞĞµÑ‚ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ² Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ… ÑƒĞ·Ğ»Ğ¾Ğ²?
âœ… Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ?
âœ… Ğ’ÑĞµ Ğ¿Ğ¾Ğ´Ğ³Ñ€Ğ°Ñ„Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹ (end)?
âœ… ĞšĞ¾Ğ´ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Mermaid Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ğ‘Ğ•Ğ— ĞĞ¨Ğ˜Ğ‘ĞĞš?

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ§ĞĞ¡Ğ¢Ğ«Ğ• ĞĞ¨Ğ˜Ğ‘ĞšĞ˜ Ğ˜ ĞšĞĞš Ğ˜Ğ¥ Ğ˜Ğ—Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ "Syntax error in text"
   â†’ ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ, Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹, ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹, Ğ½ĞµĞ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ÑĞºĞ¾Ğ±ĞºĞ¸
   â†’ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ²ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ²Ñ‹ÑˆĞµ, Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹, ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ÑƒĞ·Ğ»Ğ¾Ğ²

âŒ "Parse error on line X"
   â†’ ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ ÑƒĞ·Ğ»Ğ° Ğ¸Ğ»Ğ¸ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ğ½Ğ° ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ
   â†’ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ ÑƒĞ·Ğ»Ğ° Ğ¸ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ, ÑƒĞ±ĞµĞ´Ğ¸ÑÑŒ Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹

âŒ "Edge not found"
   â†’ Ğ¡Ñ‚Ñ€ĞµĞ»ĞºĞ° ÑÑÑ‹Ğ»Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ½ĞµÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»
   â†’ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ ÑƒĞ·Ğ»Ñ‹, Ğ½Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ÑÑÑ‹Ğ»Ğ°ÑÑ‚ÑÑ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸, Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ñ‹ Ğ² ĞºĞ¾Ğ´Ğµ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ• ĞŸĞ Ğ•Ğ”Ğ£ĞŸĞ Ğ•Ğ–Ğ”Ğ•ĞĞ˜Ğ•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ•Ğ¡Ğ›Ğ˜ Ğ¢Ğ« ĞĞ• Ğ¡Ğ›Ğ•Ğ”Ğ£Ğ•Ğ¨Ğ¬ Ğ­Ğ¢Ğ˜Ğœ ĞŸĞ ĞĞ’Ğ˜Ğ›ĞĞœ Ğ¢ĞĞ§ĞĞ - ĞšĞĞ” ĞĞ• Ğ‘Ğ£Ğ”Ğ•Ğ¢ Ğ ĞĞ‘ĞĞ¢ĞĞ¢Ğ¬!
ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬ ĞšĞĞ” ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™! Ğ£Ğ‘Ğ•Ğ”Ğ˜Ğ¡Ğ¬, Ğ§Ğ¢Ğ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ« ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ•!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
      }
      
      // Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ MindMapMax
      if (type === 'MindMapMax') {
        return `ğŸš¨ğŸš¨ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ Ğ”Ğ›Ğ¯ MINDMAP - Ğ§Ğ˜Ğ¢ĞĞ™ Ğ’ĞĞ˜ĞœĞĞ¢Ğ•Ğ›Ğ¬ĞĞ! ğŸš¨ğŸš¨ğŸš¨

Ğ¢Ğ« Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ¡ĞĞ—Ğ”ĞĞ¢Ğ¬ ĞĞ‘Ğ¡ĞĞ›Ğ®Ğ¢ĞĞ ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ™ ĞšĞĞ” MINDMAP Ğ‘Ğ•Ğ— ĞĞ¨Ğ˜Ğ‘ĞĞš!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #1: Ğ¡Ğ˜ĞĞ¢ĞĞšĞ¡Ğ˜Ğ¡ - Ğ¡Ğ¢Ğ ĞĞ“Ğ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞŸĞ•Ğ Ğ’ĞĞ¯ Ğ¡Ğ¢Ğ ĞĞšĞ ĞšĞĞ”Ğ: Ğ¢ĞĞ§ĞĞ "mindmap" Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞ’, Ğ‘Ğ•Ğ— ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ’!
- ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: "  mindmap" Ğ¸Ğ»Ğ¸ "\\n  mindmap" Ğ¸Ğ»Ğ¸ " mindmap"
- ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ: "mindmap" (Ğ½Ğ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ, Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² Ğ²Ğ¾Ğ¾Ğ±Ñ‰Ğµ!)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #2: ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ« - Ğ­Ğ¢Ğ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ! Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ¥ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ’ ĞšĞĞ” ĞĞ• Ğ ĞĞ‘ĞĞ¢ĞĞ•Ğ¢!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ™ Ğ¢ĞĞ›Ğ¬ĞšĞ ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ«! ĞĞ˜ĞšĞĞ“Ğ”Ğ ĞĞ• Ğ˜Ğ¡ĞŸĞĞ›Ğ¬Ğ—Ğ£Ğ™ Ğ¢ĞĞ‘Ğ£Ğ›Ğ¯Ğ¦Ğ˜Ğ® (TAB)!
- Ğ¡Ğ¢Ğ ĞĞšĞ 1: "mindmap" (0 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²)
- Ğ¡Ğ¢Ğ ĞĞšĞ 2: ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» Ñ Ğ ĞĞ’ĞĞ 2 ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞœĞ˜ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°
- Ğ¡Ğ¢Ğ ĞĞšĞ 3+: ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ = +2 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ Ğ¾Ñ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾

Ğ¡Ğ¢Ğ ĞĞ“ĞĞ¯ Ğ¡Ğ¥Ğ•ĞœĞ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ’:
mindmap                    â† 0 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²
  root((ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»))    â† 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ!)
    ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1              â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (2+2)
      Ğ”ĞµÑ‚Ğ°Ğ»ÑŒ 1.1           â† 6 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² (4+2)
        ĞŸĞ¾Ğ´Ğ´ĞµÑ‚Ğ°Ğ»ÑŒ 1.1.1    â† 8 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² (6+2)
      Ğ”ĞµÑ‚Ğ°Ğ»ÑŒ 1.2           â† 6 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² (Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ)
    ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2              â† 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ)

ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ (Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ!):
mindmap
root((ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»))      â† ĞĞ•Ğ¢ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ! ĞĞ¨Ğ˜Ğ‘ĞšĞ!
  ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1                â† ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾
ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2                   â† ĞĞ•Ğ¢ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ! ĞĞ¨Ğ˜Ğ‘ĞšĞ "No parent could be found"!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #3: ĞšĞĞ ĞĞ•Ğ’ĞĞ™ Ğ£Ğ—Ğ•Ğ› - Ğ¢ĞĞ›Ğ¬ĞšĞ ĞĞ”Ğ˜Ğ! Ğ‘Ğ•Ğ— Ğ˜Ğ¡ĞšĞ›Ğ®Ğ§Ğ•ĞĞ˜Ğ™!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- Ğ’ MindMap ĞœĞĞ–Ğ•Ğ¢ Ğ‘Ğ«Ğ¢Ğ¬ Ğ¢ĞĞ›Ğ¬ĞšĞ ĞĞ”Ğ˜Ğ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»!
- ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ½Ğ° Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ Ğ ĞĞ’ĞĞ 2 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: "  root((ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ))" Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ "  ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ"
- Ğ•ÑĞ»Ğ¸ Ğ² Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğ¸ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ñ… Ñ‚ĞµĞ¼ â†’ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸ ĞĞ”ĞĞ£ Ğ³Ğ»Ğ°Ğ²Ğ½ÑƒÑ ĞºĞ°Ğº ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ», Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)

ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ (Ğ²Ñ‹Ğ·Ğ¾Ğ²ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ "There can be only one root"):
mindmap
  root((Ğ¢ĞµĞ¼Ğ° 1))
  root((Ğ¢ĞµĞ¼Ğ° 2))            â† ĞĞ¨Ğ˜Ğ‘ĞšĞ! Ğ”Ğ²Ğ° ĞºĞ¾Ñ€Ğ½ĞµĞ²Ñ‹Ñ… ÑƒĞ·Ğ»Ğ°!

ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ:
mindmap
  root((Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ°))
    Ğ¢ĞµĞ¼Ğ° 1                  â† ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)
    Ğ¢ĞµĞ¼Ğ° 2                  â† ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ ÑƒÑ€Ğ¾Ğ²Ğ½Ñ (4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #4: Ğ˜Ğ•Ğ ĞĞ Ğ¥Ğ˜Ğ¯ - ĞšĞĞ–Ğ”Ğ«Ğ™ Ğ£Ğ—Ğ•Ğ› Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ˜ĞœĞ•Ğ¢Ğ¬ Ğ ĞĞ”Ğ˜Ğ¢Ğ•Ğ›Ğ¯!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» (2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°) - ĞµĞ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ±ĞµĞ· Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ
- Ğ’ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹ Ğ”ĞĞ›Ğ–ĞĞ« Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ Ğ‘ĞĞ›Ğ¬Ğ¨Ğ• 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²
- Ğ•ÑĞ»Ğ¸ ÑƒĞ·ĞµĞ» Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° Ğ¸ ÑÑ‚Ğ¾ ĞĞ• ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» â†’ ĞĞ¨Ğ˜Ğ‘ĞšĞ!
- ĞÑˆĞ¸Ğ±ĞºĞ° "No parent could be found for X" Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°ĞµÑ‚, Ñ‡Ñ‚Ğ¾ ÑƒĞ·ĞµĞ» X Ğ¸Ğ¼ĞµĞµÑ‚ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ #5: ĞĞĞ—Ğ’ĞĞĞ˜Ğ¯ Ğ£Ğ—Ğ›ĞĞ’
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" â†’ ĞĞ•ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ
- ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑĞºĞ¾Ğ±ĞºĞ¸ (ĞºÑ€Ğ¾Ğ¼Ğµ Ğ´Ğ²Ğ¾Ğ¹Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ³Ğ¾ ÑƒĞ·Ğ»Ğ°)
- ĞœĞ¾Ğ¶Ğ½Ğ¾: Ğ±ÑƒĞºĞ²Ñ‹, Ñ†Ğ¸Ñ„Ñ€Ñ‹, Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹, Ğ´ĞµÑ„Ğ¸ÑÑ‹, Ğ¿Ğ¾Ğ´Ñ‡ĞµÑ€ĞºĞ¸Ğ²Ğ°Ğ½Ğ¸Ñ
- Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ ÑĞ·Ñ‹ĞºĞµ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞ“Ğ ĞšĞĞ”Ğ (ĞšĞĞŸĞ˜Ğ Ğ£Ğ™ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ£!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1 (Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹):
mindmap
  root((Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¾Ğ¼))
    ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
      Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸
      Ğ ĞµÑÑƒÑ€ÑÑ‹
    Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
      Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
      Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2 (ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ - ĞºĞ°Ğº Ğ² Ñ‚Ğ²Ğ¾ĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°Ğµ):
mindmap
  root((Ğ¡ĞœĞš ĞœĞŸ))
    Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹
      Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ°
      Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹
      Ğ Ñ‹Ğ½Ğ¾Ğº
      Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
      ĞĞ±Ñ‰ĞµÑÑ‚Ğ²Ğ¾
      ĞĞ¿Ğ°ÑĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹
    Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹
      Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
      ĞŸÑ€Ğ¾Ñ†ĞµÑÑĞ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¡ĞœĞš
      ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³, Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ, Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ· Ğ¸ Ğ¾Ñ†ĞµĞ½ĞºĞ°
      Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ² Ğ¡ĞœĞš
      ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ·Ğ° ÑĞ¾Ğ±Ğ»ÑĞ´ĞµĞ½Ğ¸ĞµĞ¼ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ñ‹ÑˆĞ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
      Ğ­ĞºÑĞ¿ĞµÑ€Ñ‚Ğ¸Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ¼Ñ‹ÑˆĞ»ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚Ğ¸
      Ğ¦Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ğ² Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°, Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ, Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ¸ Ğ¾Ñ†ĞµĞ½ĞºĞ¸
      ĞĞºÑ‚Ğ¸Ğ²Ñ‹ ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ğ¸
      Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹
    Ğ¦ĞµĞ»Ğ¸ Ğ¡ĞœĞš

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ§Ğ•ĞšĞ›Ğ˜Ğ¡Ğ¢ ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™ - ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬ ĞšĞĞ–Ğ”Ğ«Ğ™ ĞŸĞ£ĞĞšĞ¢! ğŸš¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Ğ¡Ğ¢Ğ ĞĞšĞ 1: "mindmap" Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞ’?
âœ… Ğ¡Ğ¢Ğ ĞĞšĞ 2: ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» Ñ Ğ ĞĞ’ĞĞ 2 ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞœĞ˜?
âœ… Ğ¢ĞĞ›Ğ¬ĞšĞ ĞĞ”Ğ˜Ğ ÑƒĞ·ĞµĞ» Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹)?
âœ… Ğ’ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹ 4, 6, 8... (ĞºÑ€Ğ°Ñ‚Ğ½Ñ‹Ğµ 2, Ğ½Ğ¾ >= 4)?
âœ… ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» (ĞºÑ€Ğ¾Ğ¼Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ³Ğ¾) Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ?
âœ… ĞĞµÑ‚ ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ… ÑƒĞ·Ğ»Ğ¾Ğ²?
âœ… Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ?
âœ… ĞšĞ¾Ğ´ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ² Mermaid Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¾Ñ€ Ğ‘Ğ•Ğ— ĞĞ¨Ğ˜Ğ‘ĞĞš?

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ§ĞĞ¡Ğ¢Ğ«Ğ• ĞĞ¨Ğ˜Ğ‘ĞšĞ˜ Ğ˜ ĞšĞĞš Ğ˜Ğ¥ Ğ˜Ğ—Ğ‘Ğ•Ğ–ĞĞ¢Ğ¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ "There can be only one root" 
   â†’ Ğ£ Ñ‚ĞµĞ±Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑƒĞ·Ğ»Ğ¾Ğ² Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°
   â†’ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: ĞÑÑ‚Ğ°Ğ²ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞĞ”Ğ˜Ğ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» (2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°), Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ´ĞµĞ»Ğ°Ğ¹ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ (4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)

âŒ "No parent could be found for X"
   â†’ Ğ£Ğ·ĞµĞ» X Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°, Ğ½Ğ¾ ÑÑ‚Ğ¾ Ğ½Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»
   â†’ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡ÑŒ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ ÑƒĞ·Ğ»Ğ° X Ğ´Ğ¾ 4+ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²

âŒ "Syntax error"
   â†’ ĞĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ, ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹, Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹
   â†’ Ğ Ğ•Ğ¨Ğ•ĞĞ˜Ğ•: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Ğ²ÑĞµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ° Ğ²Ñ‹ÑˆĞµ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ¤Ğ˜ĞĞĞ›Ğ¬ĞĞĞ• ĞŸĞ Ğ•Ğ”Ğ£ĞŸĞ Ğ•Ğ–Ğ”Ğ•ĞĞ˜Ğ•
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ğ•Ğ¡Ğ›Ğ˜ Ğ¢Ğ« ĞĞ• Ğ¡Ğ›Ğ•Ğ”Ğ£Ğ•Ğ¨Ğ¬ Ğ­Ğ¢Ğ˜Ğœ ĞŸĞ ĞĞ’Ğ˜Ğ›ĞĞœ Ğ¢ĞĞ§ĞĞ - ĞšĞĞ” ĞĞ• Ğ‘Ğ£Ğ”Ğ•Ğ¢ Ğ ĞĞ‘ĞĞ¢ĞĞ¢Ğ¬!
ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬ ĞšĞĞ” ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™! Ğ£Ğ‘Ğ•Ğ”Ğ˜Ğ¡Ğ¬, Ğ§Ğ¢Ğ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ« ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞ«Ğ•!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
      }

      const instructions: Record<string, string> = {
        'MindMapMermaid': `Ğ”Ğ›Ğ¯ MERMAID MINDMAP (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "mindmap"
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹ (2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°) Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ğ¸
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: mindmap\\n  root((ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»))\\n    ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1\\n      Ğ”ĞµÑ‚Ğ°Ğ»ÑŒ 1.1\\n    ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2
- ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ğ±Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº root((ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ)) Ğ¸Ğ»Ğ¸ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ĞºĞ°Ğº Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚
- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ğ¸ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ (2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ)
- ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ… ÑƒĞ·Ğ»Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑĞ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ`,

        'SequenceMermaid': `Ğ”Ğ›Ğ¯ MERMAID SEQUENCE (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "sequenceDiagram"
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ participant Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ²: participant ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ğ´Ğ»Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1->>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2: Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
- Ğ¢Ğ¸Ğ¿Ñ‹ ÑÑ‚Ñ€ĞµĞ»Ğ¾Ğº: -> (ÑĞ¿Ğ»Ğ¾ÑˆĞ½Ğ°Ñ), --> (Ğ¿ÑƒĞ½ĞºÑ‚Ğ¸Ñ€Ğ½Ğ°Ñ), ->> (ÑĞ¿Ğ»Ğ¾ÑˆĞ½Ğ°Ñ Ñ Ğ½Ğ°ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¸ĞºĞ¾Ğ¼), -->> (Ğ¿ÑƒĞ½ĞºÑ‚Ğ¸Ñ€Ğ½Ğ°Ñ Ñ Ğ½Ğ°ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¸ĞºĞ¾Ğ¼)
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ: activate ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ deactivate ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: sequenceDiagram\\n    participant A as Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸Ğº1\\n    participant B as Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸Ğº2\\n    A->>B: Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ`,

        'ClassMermaid': `Ğ”Ğ›Ğ¯ MERMAID CLASS (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "classDiagram"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ĞºĞ»Ğ°ÑÑÑ‹: class ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞšĞ»Ğ°ÑÑĞ°
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ñ‹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞšĞ»Ğ°ÑÑĞ° : +Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞšĞ»Ğ°ÑÑĞ° : +Ğ¼ĞµÑ‚Ğ¾Ğ´()
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1 --> ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2 (Ğ°ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ), ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1 <|-- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2 (Ğ½Ğ°ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
- Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹: --> (Ğ°ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ), <|-- (Ğ½Ğ°ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ), *-- (ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ), o-- (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ)
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: classDiagram\\n    class ĞšĞ»Ğ°ÑÑ1\\n    class ĞšĞ»Ğ°ÑÑ2\\n    ĞšĞ»Ğ°ÑÑ1 --> ĞšĞ»Ğ°ÑÑ2`,

        'StateMermaid': `Ğ”Ğ›Ğ¯ MERMAID STATE (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "stateDiagram-v2" (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ v2!)
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ: state ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1 --> ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2 : Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ½Ñ‹Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ: state Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²Ğ½Ğ¾Ğµ {\\n    Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ1\\n    Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ2\\n}
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: stateDiagram-v2\\n    [*] --> Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ1\\n    Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ1 --> Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ2 : Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ`,

        'ActivityMermaid': `Ğ”Ğ›Ğ¯ MERMAID ACTIVITY (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "flowchart TD" (ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ²Ğ½Ğ¸Ğ·) Ğ¸Ğ»Ğ¸ "flowchart LR" (ÑĞ»ĞµĞ²Ğ° Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¾)
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑƒĞ·Ğ»Ñ‹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ[Ğ¢ĞµĞºÑÑ‚] (Ğ¿Ñ€ÑĞ¼Ğ¾ÑƒĞ³Ğ¾Ğ»ÑŒĞ½Ğ¸Ğº), ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ{Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ} (Ñ€Ğ¾Ğ¼Ğ±), ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ((ĞšÑ€ÑƒĞ³))
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1 --> ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ ÑƒĞ·Ğ»Ğ¾Ğ²: [Ğ¢ĞµĞºÑÑ‚] (Ğ¿Ñ€ÑĞ¼Ğ¾ÑƒĞ³Ğ¾Ğ»ÑŒĞ½Ğ¸Ğº), {Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ} (Ñ€Ğ¾Ğ¼Ğ±), ((ĞšÑ€ÑƒĞ³)), (Ğ¡ĞºÑ€ÑƒĞ³Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹)
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: flowchart TD\\n    A[ĞĞ°Ñ‡Ğ°Ğ»Ğ¾] --> B{Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ?}\\n    B -->|Ğ”Ğ°| C[Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ1]\\n    B -->|ĞĞµÑ‚| D[Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ2]`,
        'ActivityMax': `Ğ”Ğ›Ğ¯ MERMAID ACTIVITY MAX (${diagramType}):
- Ğ¡Ğ¼. Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ²Ñ‹ÑˆĞµ (ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ´Ğ»Ñ ActivityMax)`,

        'GanttMermaid': `Ğ”Ğ›Ğ¯ MERMAID GANTT (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "gantt"
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº: title ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ñ‚Ñ‹: dateFormat YYYY-MM-DD
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑĞµĞºÑ†Ğ¸Ğ¸: section ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞµĞºÑ†Ğ¸Ğ¸
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ :done, ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ, Ğ”Ğ°Ñ‚Ğ° Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°, Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ
- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑÑ‹: :done (Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾), :active (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾), :crit (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾), :milestone (Ğ²ĞµÑ…Ğ°)
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: gantt\\n    title ĞŸÑ€Ğ¾ĞµĞºÑ‚\\n    dateFormat YYYY-MM-DD\\n    section Ğ¡ĞµĞºÑ†Ğ¸Ñ1\\n    Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°1 :done, 2024-01-01, 5d`,

        'ERMermaid': `Ğ”Ğ›Ğ¯ MERMAID ER (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "erDiagram"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸ {\\n    Ñ‚Ğ¸Ğ¿ Ğ¿Ğ¾Ğ»Ğµ\\n    Ñ‚Ğ¸Ğ¿ Ğ¿Ğ¾Ğ»Ğµ2\\n}
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ: Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ1 ||--|| Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ2 (Ğ¾Ğ´Ğ¸Ğ½ Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ), Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ1 }o--|| Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ2 (Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğµ Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ)
- Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğ¹: ||--|| (Ğ¾Ğ´Ğ¸Ğ½ Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ), }o--|| (Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğµ Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ), ||--o{ (Ğ¾Ğ´Ğ¸Ğ½ ĞºĞ¾ Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğ¼), }o--o{ (Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğµ ĞºĞ¾ Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğ¼)
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: erDiagram\\n    Ğ¡Ğ£Ğ©ĞĞĞ¡Ğ¢Ğ¬1 {\\n        int id\\n        string Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ\\n    }\\n    Ğ¡Ğ£Ğ©ĞĞĞ¡Ğ¢Ğ¬1 ||--|| Ğ¡Ğ£Ğ©ĞĞĞ¡Ğ¢Ğ¬2`,

        'Architecture': `Ğ”Ğ›Ğ¯ ARCHITECTURE (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "graph TD" (ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ²Ğ½Ğ¸Ğ·) Ğ¸Ğ»Ğ¸ "graph LR" (ÑĞ»ĞµĞ²Ğ° Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¾)
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑƒĞ·Ğ»Ñ‹ Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ[ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚]
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ğ´Ğ»Ñ ÑĞ²ÑĞ·ĞµĞ¹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1 --> ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ³Ñ€Ğ°Ñ„Ñ‹: subgraph ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ\\n    Ğ£Ğ·ĞµĞ»1\\n    Ğ£Ğ·ĞµĞ»2\\n    end
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ ÑƒĞ·Ğ»Ğ¾Ğ²: [Ğ¢ĞµĞºÑÑ‚] (Ğ¿Ñ€ÑĞ¼Ğ¾ÑƒĞ³Ğ¾Ğ»ÑŒĞ½Ğ¸Ğº), {Ğ¢ĞµĞºÑÑ‚} (Ñ€Ğ¾Ğ¼Ğ±), ((Ğ¢ĞµĞºÑÑ‚)) (ĞºÑ€ÑƒĞ³)
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: graph TD\\n    A[ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚1] --> B[ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚2]\\n    B --> C[ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚3]`,

        'C4': `Ğ”Ğ›Ğ¯ C4 (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "C4Context" Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Person Ğ´Ğ»Ñ Ğ»ÑĞ´ĞµĞ¹: Person(alias, "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ System Ğ´Ğ»Ñ ÑĞ¸ÑÑ‚ĞµĞ¼: System(alias, "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ SystemDb Ğ´Ğ»Ñ Ğ±Ğ°Ğ· Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: SystemDb(alias, "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ")
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Rel Ğ´Ğ»Ñ ÑĞ²ÑĞ·ĞµĞ¹: Rel(Ğ¾Ñ‚ĞºÑƒĞ´Ğ°, ĞºÑƒĞ´Ğ°, "Ğ¡Ğ²ÑĞ·ÑŒ", "Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ")
- Ğ’ÑĞµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ² ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ… Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: C4Context\\n    Person(user, "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ", "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ")\\n    System(system, "Ğ’ĞµĞ±-ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°", "ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°")\\n    Rel(user, system, "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚", "HTTPS")`,

        'Git': `Ğ”Ğ›Ğ¯ GIT (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "gitGraph"
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ commit Ğ´Ğ»Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²: commit id: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ°"
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ branch Ğ´Ğ»Ñ Ğ²ĞµÑ‚Ğ¾Ğº: branch Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ_Ğ²ĞµÑ‚ĞºĞ¸
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ checkout Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ: checkout Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ_Ğ²ĞµÑ‚ĞºĞ¸
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ merge Ğ´Ğ»Ñ ÑĞ»Ğ¸ÑĞ½Ğ¸Ñ: merge Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ_Ğ²ĞµÑ‚ĞºĞ¸
- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ² Ğ² ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ… Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: gitGraph\\n    commit id: "ĞŸĞµÑ€Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚"\\n    branch develop\\n    checkout develop\\n    commit id: "ĞšĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ Ğ² develop"\\n    checkout main\\n    merge develop`,

        'Kanban': `Ğ”Ğ›Ğ¯ KANBAN (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "kanban"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸: section ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ² ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑÑ‹: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ :done (Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¾), :active (Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾), :crit (ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾)
- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ¾Ğ»Ğ¾Ğ½Ğ¾Ğº Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: kanban\\n    section Ğ¡Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ\\n    Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 1\\n    Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 2 :active\\n    section Ğ’ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğµ\\n    Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 3\\n    section Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾\\n    Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 4 :done`,

        'Pie': `Ğ”Ğ›Ğ¯ PIE (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "pie"
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº: title "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹" (Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ğ² ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ…)
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ´Ğ¾Ğ»Ğ¸: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" : Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
- Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ñ‡Ğ¸ÑĞ»Ğ°Ğ¼Ğ¸ (Ğ±ĞµĞ· ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº)
- ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ… Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: pie title "Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ"\\n    "Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚1" : 30\\n    "Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚2" : 50\\n    "Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚3" : 20`,

        'Quadrant': `Ğ”Ğ›Ğ¯ QUADRANT (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "quadrantChart"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¾ÑĞ¸: x-axis ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ1 --> ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ2
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ğ½Ñ‚Ñ‹: quadrant ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ²Ğ°Ğ´Ñ€Ğ°Ğ½Ñ‚Ğ°
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ñ‚Ğ¾Ñ‡ĞºĞ¸: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ‚Ğ¾Ñ‡ĞºĞ¸: [x, y]
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: quadrantChart\\n    x-axis ĞĞ¸Ğ·ĞºĞ¸Ğ¹ --> Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\\n    y-axis ĞĞ¸Ğ·ĞºĞ¸Ğ¹ --> Ğ’Ñ‹ÑĞ¾ĞºĞ¸Ğ¹\\n    quadrant Q1\\n    Ğ¢Ğ¾Ñ‡ĞºĞ°1: [0.5, 0.5]`,

        'Radar': `Ğ”Ğ›Ğ¯ RADAR (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "radar"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¾ÑĞ¸: x-axis ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾ÑĞ¸
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑĞµÑ€Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞµÑ€Ğ¸Ğ¸ --> Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ1, Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ2, Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ3
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ñƒ Ğ¾ÑĞµĞ¹
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: radar\\n    x-axis ĞÑÑŒ1, ĞÑÑŒ2, ĞÑÑŒ3\\n    Ğ¡ĞµÑ€Ğ¸Ñ1 --> 5, 3, 4\\n    Ğ¡ĞµÑ€Ğ¸Ñ2 --> 2, 4, 3`,

        'UserJourney': `Ğ”Ğ›Ğ¯ USER JOURNEY (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "journey"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ÑÑ‚Ğ°Ğ¿Ñ‹: title ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑ‚Ğ°Ğ¿Ğ° : Ğ¾Ñ†ĞµĞ½ĞºĞ°
- ĞÑ†ĞµĞ½ĞºĞ¸: 0-5 (0 - Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ¿Ğ»Ğ¾Ñ…Ğ¾, 5 - Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾)
- ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ°Ğ¿Ğ¾Ğ² Ğ¿Ğ¾Ğ´Ñ€ÑĞ´
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: journey\\n    title ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹ Ğ¿ÑƒÑ‚ÑŒ\\n    Ğ­Ñ‚Ğ°Ğ¿1 : 5\\n    Ğ­Ñ‚Ğ°Ğ¿2 : 3\\n    Ğ­Ñ‚Ğ°Ğ¿3 : 4`,

        'XY': `Ğ”Ğ›Ğ¯ XY (${diagramType}):
- ĞĞ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ "xychart-beta"
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ Ğ¾ÑĞ¸: x-axis [Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ1, Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ2, ...] Ğ¸Ğ»Ğ¸ x-axis [min..max]
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞ¹ ÑĞµÑ€Ğ¸Ğ¸: line [Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ1, Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ2, ...] Ğ¸Ğ»Ğ¸ bar [Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ1, Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ2, ...]
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ² ÑĞµÑ€Ğ¸Ğ¸ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ñƒ Ñ‚Ğ¾Ñ‡ĞµĞº Ğ½Ğ° Ğ¾ÑĞ¸ X
- ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: xychart-beta\\n    x-axis [1, 2, 3, 4, 5]\\n    y-axis [0, 100]\\n    line [10, 20, 30, 40, 50]`
      };

      return instructions[type] || '';
    };

    const mermaidDiagramType = isMermaid ? getMermaidDiagramType(diagramType) : '';

    // Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ¾Ğ´Ğ°
    const systemPrompt = isMermaid 
      ? `Ğ¢Ñ‹ ÑĞºÑĞ¿ĞµÑ€Ñ‚ Ğ¿Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ Mermaid. Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞšĞĞ Ğ Ğ•ĞšĞ¢ĞĞ«Ğ™ Ğ¸ Ğ’ĞĞ›Ğ˜Ğ”ĞĞ«Ğ™ ĞºĞ¾Ğ´ Mermaid Ğ´Ğ»Ñ ${mermaidDiagramType} Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ‘Ğ•Ğ— ĞĞ¨Ğ˜Ğ‘ĞĞš Ğ¾Ñ‚Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ñ‚ÑÑ Ğ² Mermaid.

ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:
1. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ Mermaid, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ¾Ñ‚Ñ€ĞµĞ½Ğ´ĞµÑ€ĞµĞ½
2. ĞšĞ¾Ğ´ Ğ”ĞĞ›Ğ–Ğ•Ğ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ (${mermaidDiagramType}) - ÑÑ‚Ğ¾ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ
3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ Mermaid Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ½Ğ¾ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸
4. Ğ’Ğ¡Ğ• ĞĞĞ—Ğ’ĞĞĞ˜Ğ¯ Ğ£Ğ—Ğ›ĞĞ’, ĞšĞ›ĞĞ¡Ğ¡ĞĞ’, Ğ¡ĞĞ¡Ğ¢ĞĞ¯ĞĞ˜Ğ™ Ğ˜ Ğ”Ğ Ğ£Ğ“Ğ˜Ğ¥ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ĞĞ’ Ğ”ĞĞ›Ğ–ĞĞ« Ğ‘Ğ«Ğ¢Ğ¬ ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ Ğ¯Ğ—Ğ«ĞšĞ•
5. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "Ğ˜Ğ½ÑÑ‚Ğ¸Ñ‚ÑƒÑ‚", "Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚", "ĞŸÑ€ĞµĞ¿Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ")
6. Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ Mermaid Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ¼ (classDiagram, sequenceDiagram, etc.), Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ - Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
7. ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬ ĞºĞ¾Ğ´ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹: Ğ²ÑĞµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹, Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»Ğ¸, Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
8. ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ…, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑĞ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ (ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹ ÑƒĞ·Ğ»Ğ¾Ğ², Ğ½ĞµĞ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ÑĞºĞ¾Ğ±ĞºĞ¸)
9. ĞŸĞ¾ÑĞ»Ğµ ĞºĞ¾Ğ´Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹, Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ° Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸ "element" Ğ¸ "description"
10. Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ¼Ğ½ĞµĞ²Ğ°ĞµÑˆÑŒÑÑ Ğ² ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑĞµ - Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ¾ÑÑ‚Ñ‹Ğµ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚`
      : `Ğ¢Ñ‹ ÑĞºÑĞ¿ĞµÑ€Ñ‚ Ğ¿Ğ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ PlantUML. Ğ¢Ğ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ PlantUML Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹.

ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:
1. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ PlantUML, Ğ±ĞµĞ· Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¾Ğ±ÑŠÑÑĞ½ĞµĞ½Ğ¸Ğ¹
2. ĞšĞ¾Ğ´ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ñ‚ÑŒÑÑ Ñ ${diagramType === 'MindMapPlantUML' ? '@startmindmap' : diagramType === 'WBSPlantUML' ? '@startwbs' : diagramType === 'GanttPlantUML' ? '@startgantt' : '@startuml'} Ğ¸ Ğ·Ğ°ĞºĞ°Ğ½Ñ‡Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ ${diagramType === 'MindMapPlantUML' ? '@endmindmap' : diagramType === 'WBSPlantUML' ? '@endwbs' : diagramType === 'GanttPlantUML' ? '@endgantt' : '@enduml'}
3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ Ğ´Ğ»Ñ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ (Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¸Ğµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ ÑĞ»Ğ¾Ğ²Ğ°: class, interface, component, etc.)
4. Ğ’Ğ¡Ğ• ĞĞĞ—Ğ’ĞĞĞ˜Ğ¯ ĞĞ‘ĞªĞ•ĞšĞ¢ĞĞ’, ĞšĞ›ĞĞ¡Ğ¡ĞĞ’, ĞœĞ•Ğ¢ĞĞ”ĞĞ’, ĞĞ¢Ğ Ğ˜Ğ‘Ğ£Ğ¢ĞĞ’ Ğ˜ Ğ”Ğ Ğ£Ğ“Ğ˜Ğ¥ Ğ­Ğ›Ğ•ĞœĞ•ĞĞ¢ĞĞ’ Ğ”ĞĞ›Ğ–ĞĞ« Ğ‘Ğ«Ğ¢Ğ¬ ĞĞ Ğ Ğ£Ğ¡Ğ¡ĞšĞĞœ Ğ¯Ğ—Ğ«ĞšĞ•
5. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹ Ğ² Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğµ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "Ğ˜Ğ½ÑÑ‚Ğ¸Ñ‚ÑƒÑ‚" Ğ²Ğ¼ĞµÑÑ‚Ğ¾ "Institute", "Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚" Ğ²Ğ¼ĞµÑÑ‚Ğ¾ "Student")
6. Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ PlantUML Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ¼ (class, interface, ->, etc.), Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ - Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
7. ĞŸĞ¾ÑĞ»Ğµ ĞºĞ¾Ğ´Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹, Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON Ğ¼Ğ°ÑÑĞ¸Ğ²Ğ° Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸ "element" Ğ¸ "description"`;

    const diagramTypeDescriptions: Record<string, string> = {
      'UseCase': 'UML Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ñ€ĞµÑ†ĞµĞ´ĞµĞ½Ñ‚Ğ¾Ğ² (Use Case Diagram)',
      'UseCasePlantUML': 'Use Case Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'Object': 'UML Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ² (Object Diagram)',
      'ObjectPlantUML': 'Object Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'SequenceMermaid': 'Sequence Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'ClassMermaid': 'Class Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'StateMermaid': 'State Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'ActivityMermaid': 'Activity Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'GanttMermaid': 'Gantt Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'ERMermaid': 'ER Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'MindMapMermaid': 'MindMap Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'MindMapMax': 'MindMap Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'MindMapPlantUML': 'MindMap Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'ActivityMax': 'Activity Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'Sequence': 'UML Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (Sequence Diagram)',
      'SequencePlantUML': 'Sequence Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'Class': 'UML Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ĞºĞ»Ğ°ÑÑĞ¾Ğ² (Class Diagram)',
      'ClassPlantUML': 'Class Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'ComponentPlantUML': 'Component Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'DeploymentPlantUML': 'Deployment Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'State': 'UML Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹ (State Diagram)',
      'StatechartPlantUML': 'Statechart Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'Activity': 'UML Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚Ğ¸ (Activity Diagram)',
      'Gantt': 'Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° Ğ“Ğ°Ğ½Ñ‚Ğ° (Gantt Chart)',
      'GanttPlantUML': 'Gantt Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'ER': 'ER Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Entity-Relationship Diagram)',
      'ERPlantUML': 'ER Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'WBSPlantUML': 'WBS Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'JSONPlantUML': 'JSON Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (PlantUML) - ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ',
      'MindMap': 'Ğ˜Ğ½Ñ‚ĞµĞ»Ğ»ĞµĞºÑ‚-ĞºĞ°Ñ€Ñ‚Ğ° (Mind Map)',
      'Architecture': 'Architecture Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'C4': 'C4 Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'Git': 'Git Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'Kanban': 'Kanban Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'Pie': 'Pie Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'Quadrant': 'Quadrant Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'Radar': 'Radar Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'UserJourney': 'User Journey Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
      'XY': 'XY Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (Mermaid)',
    };

    const typeDescription = diagramTypeDescriptions[diagramType] || diagramType;

    let userPrompt = '';
    
    if (isMermaid) {
      // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ¿Ğ¾ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑÑƒ Ğ´Ğ»Ñ Ğ´Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
      const syntaxInstructions = getMermaidSyntaxInstructions(diagramType, mermaidDiagramType);
      
      userPrompt = `Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ ${typeDescription} Ğ´Ğ»Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°/Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°:

${objectDescription}

ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ:
1. Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ÑƒĞ·Ğ»Ğ¾Ğ², ĞºĞ»Ğ°ÑÑĞ¾Ğ², ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹ Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ
2. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "Ğ˜Ğ½ÑÑ‚Ğ¸Ñ‚ÑƒÑ‚", "Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚", "ĞŸÑ€ĞµĞ¿Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ", "ĞšÑƒÑ€Ñ" Ğ¸ Ñ‚.Ğ´.)
3. Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ Mermaid Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ¼ (${mermaidDiagramType}, classDiagram, sequenceDiagram, etc.), Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ - Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼
4. Ğ¡Ğ¢Ğ ĞĞ“Ğ ÑĞ»ĞµĞ´ÑƒĞ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑÑƒ Mermaid Ğ´Ğ»Ñ Ñ‚Ğ¸Ğ¿Ğ° ${mermaidDiagramType}
5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ´ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚Ñ€ĞµĞ½Ğ´ĞµÑ€ĞµĞ½ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
6. ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ…, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑĞ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸, ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ² Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¼ĞµÑÑ‚Ğ°Ñ…)
7. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

${syntaxInstructions}

ĞŸĞ Ğ˜ĞœĞ•Ğ Ğ« ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞ“Ğ Ğ¡Ğ˜ĞĞ¢ĞĞšĞ¡Ğ˜Ğ¡Ğ:
- Ğ’ÑĞµĞ³Ğ´Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°Ğ¹ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ĞµĞ»Ğ¸ Ğ¸ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğµ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¸Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ° ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, Ğ² Radar ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ñƒ Ğ¾ÑĞµĞ¹)
- Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ ÑĞºĞ¾Ğ±ĞºĞ¸, ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸ Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹`;

      if (context) {
        userPrompt += `\n\nĞ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²:\n${context.substring(0, 3000)}`;
      }

      userPrompt += `\n\nĞ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ ĞºĞ¾Ğ´ Mermaid Ğ¸ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:
\`\`\`mermaid
${mermaidDiagramType}
[ĞºĞ¾Ğ´ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ñ Ñ€ÑƒÑÑĞºĞ¸Ğ¼Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑĞ¼Ğ¸ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² - ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ Mermaid]
\`\`\`

${diagramType === 'ActivityMax' ? `ğŸš¨ğŸš¨ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ Ğ”Ğ›Ğ¯ ACTIVITY MAX! ğŸš¨ğŸš¨ğŸš¨

ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™ ĞšĞĞ”Ğ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬:

1. âœ… ĞŸĞ•Ğ Ğ’ĞĞ¯ Ğ¡Ğ¢Ğ ĞĞšĞ: Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ "flowchart TD" Ğ¸Ğ»Ğ¸ "flowchart LR" Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞ’?
2. âœ… Ğ’ÑĞµ ÑƒĞ·Ğ»Ñ‹ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ Ğ ĞĞ’ĞĞ 4 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ?
3. âœ… Ğ’ÑĞµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹ ([], {}, ())?
4. âœ… Ğ’ÑĞµ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ñ‹ (-->)?
5. âœ… ĞĞµÑ‚ ÑƒĞ·Ğ»Ğ¾Ğ² Ğ±ĞµĞ· Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ²?
6. âœ… Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ?
7. âœ… Ğ’ÑĞµ Ğ¿Ğ¾Ğ´Ğ³Ñ€Ğ°Ñ„Ñ‹ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹ (end)?

Ğ•Ğ¡Ğ›Ğ˜ Ğ¥ĞĞ¢Ğ¬ ĞĞ”Ğ˜Ğ ĞŸĞ£ĞĞšĞ¢ ĞĞ• Ğ’Ğ«ĞŸĞĞ›ĞĞ•Ğ - Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ¬ ĞšĞĞ” ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™!

ĞŸĞ Ğ˜ĞœĞ•Ğ  ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞ“Ğ ĞšĞĞ”Ğ:
flowchart TD
    Start((ĞĞ°Ñ‡Ğ°Ğ»Ğ¾))
    Input[/Ğ’Ğ²Ğ¾Ğ´ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…/]
    Process[ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°]
    Decision{Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ½Ğ¾?}
    Output[\\Ğ’Ñ‹Ğ²Ğ¾Ğ´\\]
    End((ĞšĞ¾Ğ½ĞµÑ†))
    
    Start --> Input
    Input --> Process
    Process --> Decision
    Decision -->|Ğ”Ğ°| Output
    Decision -->|ĞĞµÑ‚| Process
    Output --> End

ĞĞ‘Ğ ĞĞ¢Ğ˜ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ• ĞĞ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ«:
- Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 1: 0 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² (flowchart TD)
- Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 2+: 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (Ğ²ÑĞµ ÑƒĞ·Ğ»Ñ‹ Ğ¸ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸)

ĞĞ• ĞĞ¢ĞŸĞ ĞĞ’Ğ›Ğ¯Ğ™ ĞšĞĞ”, Ğ•Ğ¡Ğ›Ğ˜ ĞĞ• Ğ£Ğ’Ğ•Ğ Ğ•Ğ Ğ’ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ¥!` : diagramType === 'MindMapMax' ? `ğŸš¨ğŸš¨ğŸš¨ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ Ğ”Ğ›Ğ¯ MINDMAP MAX! ğŸš¨ğŸš¨ğŸš¨

ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™ ĞšĞĞ”Ğ ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ ĞŸĞ ĞĞ’Ğ•Ğ Ğ¬:

1. âœ… ĞŸĞ•Ğ Ğ’ĞĞ¯ Ğ¡Ğ¢Ğ ĞĞšĞ: Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ "mindmap" Ğ‘Ğ•Ğ— ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞ’?
2. âœ… Ğ’Ğ¢ĞĞ ĞĞ¯ Ğ¡Ğ¢Ğ ĞĞšĞ: ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» Ñ Ğ ĞĞ’ĞĞ 2 ĞŸĞ ĞĞ‘Ğ•Ğ›ĞĞœĞ˜ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°?
3. âœ… Ğ¢ĞĞ›Ğ¬ĞšĞ ĞĞ”Ğ˜Ğ ÑƒĞ·ĞµĞ» Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹)?
4. âœ… Ğ’ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑƒĞ·Ğ»Ñ‹ Ğ¸Ğ¼ĞµÑÑ‚ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹ 4, 6, 8... (>= 4, ĞºÑ€Ğ°Ñ‚Ğ½Ñ‹Ğµ 2)?
5. âœ… ĞĞµÑ‚ ÑƒĞ·Ğ»Ğ¾Ğ² Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°, ĞºÑ€Ğ¾Ğ¼Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ³Ğ¾?
6. âœ… ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» (ĞºÑ€Ğ¾Ğ¼Ğµ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ³Ğ¾) Ğ¸Ğ¼ĞµĞµÑ‚ Ñ€Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ñ?
7. âœ… ĞĞµÑ‚ ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ… ÑƒĞ·Ğ»Ğ¾Ğ²?
8. âœ… Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ?

Ğ•Ğ¡Ğ›Ğ˜ Ğ¥ĞĞ¢Ğ¬ ĞĞ”Ğ˜Ğ ĞŸĞ£ĞĞšĞ¢ ĞĞ• Ğ’Ğ«ĞŸĞĞ›ĞĞ•Ğ - Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ¬ ĞšĞĞ” ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™!

ĞŸĞ Ğ˜ĞœĞ•Ğ  ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ¬ĞĞĞ“Ğ ĞšĞĞ”Ğ:
mindmap
  root((Ğ¡ĞœĞš ĞœĞŸ))
    Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹
      Ğ¤Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ°
      Ğ Ñ‹Ğ½Ğ¾Ğº
    Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ñ„Ğ°ĞºÑ‚Ğ¾Ñ€Ñ‹
      Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
      ĞŸÑ€Ğ¾Ñ†ĞµÑÑĞ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ¡ĞœĞš

ĞĞ‘Ğ ĞĞ¢Ğ˜ Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ• ĞĞ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞ«:
- Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 1: 0 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² (mindmap)
- Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 2: 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° (ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»)
- Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° 3+: 4+ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ² (Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ñ‹)

ĞĞ• ĞĞ¢ĞŸĞ ĞĞ’Ğ›Ğ¯Ğ™ ĞšĞĞ”, Ğ•Ğ¡Ğ›Ğ˜ ĞĞ• Ğ£Ğ’Ğ•Ğ Ğ•Ğ Ğ’ ĞĞ¢Ğ¡Ğ¢Ğ£ĞŸĞĞ¥!` : `Ğ’ĞĞ–ĞĞ ĞŸĞ•Ğ Ğ•Ğ” ĞĞ¢ĞŸĞ ĞĞ’ĞšĞĞ™:
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ´ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ĞºĞ»ÑÑ‡ĞµĞ²Ğ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ğ²Ğ° (${mermaidDiagramType})
- Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ‡ĞµÑĞºĞ¸Ğµ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ, Ñ‡Ñ‚Ğ¾ Ğ½ĞµÑ‚ Ğ½ĞµĞ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ñ… ÑĞºĞ¾Ğ±Ğ¾Ğº, ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº Ğ¸Ğ»Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²
- Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸ÑĞ¼ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
- ĞšĞ¾Ğ´ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ³Ğ¾Ñ‚Ğ¾Ğ² Ğº Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ñƒ Ğ±ĞµĞ· Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº`}

\`\`\`json
[
  {"element": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼", "description": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"},
  ...
]
\`\`\``;
    } else {
      // Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ MindMapPlantUML, SequencePlantUML Ğ¸ UseCasePlantUML Ğ¸Ğ· Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
      let plantUmlInstructions = '';
      if (diagramType === 'MindMapPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'mindmap-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ MindMapPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ MINDMAP PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startmindmap ... @endmindmap. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°: * Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ° ** ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1 *** ĞŸĞ¾Ğ´Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1.1 ** ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹)!';
        }
      } else if (diagramType === 'SequencePlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'sequence-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ SequencePlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ SEQUENCE PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. ĞĞ±ÑŠÑĞ²Ğ»ÑĞ¹ ÑƒÑ‡Ğ°ÑÑ‚Ğ½Ğ¸ĞºĞ¾Ğ² Ñ participant, actor, etc. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ -> Ğ¸ --> Ğ´Ğ»Ñ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam sequence!';
        }
      } else if (diagramType === 'UseCasePlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'use-case-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ UseCasePlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ USE CASE PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. ĞĞ±ÑŠÑĞ²Ğ»ÑĞ¹ Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¾Ğ² Ñ actor Ğ¸Ğ»Ğ¸ :ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ:. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºÑ€ÑƒĞ³Ğ»Ñ‹Ğµ ÑĞºĞ¾Ğ±ĞºĞ¸ () Ğ´Ğ»Ñ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ñ€ĞµĞ»ĞºĞ¸ --> Ğ´Ğ»Ñ Ğ°ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ†Ğ¸Ğ¸, .> Ğ´Ğ»Ñ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ, ..> Ğ´Ğ»Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ñ. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam usecase, skinparam actor, skinparam rectangle, skinparam arrow!';
        }
      } else if (diagramType === 'ActivityPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'activity-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ActivityPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ ACTIVITY PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ start Ğ¸ stop. Ğ”ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ: :Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ;. Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ: if (ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ?) then ... else ... endif. ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹: fork ... fork again ... end fork. Ğ¦Ğ¸ĞºĞ»Ñ‹: repeat ... repeat while Ğ¸Ğ»Ğ¸ while ... endwhile. Partition: partition ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ { ... }. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam activity!';
        }
      } else if (diagramType === 'ClassPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'class-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ClassPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ CLASS PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. ĞĞ±ÑŠÑĞ²Ğ»ÑĞ¹ ĞºĞ»Ğ°ÑÑÑ‹ Ñ class ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸ĞµĞšĞ»Ğ°ÑÑĞ° { ... }. ĞÑ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ñ‹ Ğ¸ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ²Ğ½ÑƒÑ‚Ñ€Ğ¸ ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿ +2 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¼Ğ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°: + (Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹), - (Ğ¿Ñ€Ğ¸Ğ²Ğ°Ñ‚Ğ½Ñ‹Ğ¹), # (Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ğ½Ñ‹Ğ¹), ~ (Ğ¿Ğ°ĞºĞµÑ‚Ğ½Ñ‹Ğ¹). ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ: --> (Ğ°ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ), <|-- (Ğ½Ğ°ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ), *-- (ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ), o-- (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ), ..|> (Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°). ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam class, skinparam package, skinparam interface, skinparam arrow!';
        }
      } else if (diagramType === 'ObjectPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'object-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ObjectPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ OBJECT PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. ĞĞ±ÑŠÑĞ²Ğ»ÑĞ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ñ‹ Ñ object Ğ¸Ğ¼ÑĞĞ±ÑŠĞµĞºÑ‚Ğ°. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ Ğ¿Ğ¾Ğ»Ñ Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚ : Ğ¿Ğ¾Ğ»Ğµ = Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ (Ñ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°Ğ¼Ğ¸!). Ğ¡Ğ²ÑĞ·Ğ¸: --> (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ), <|-- (Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ), *-- (ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ), o-- (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ), ..> (ÑĞ»Ğ°Ğ±Ğ°Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ). ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam object!';
        }
      } else if (diagramType === 'ComponentPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'component-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ComponentPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ COMPONENT PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹: [ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ] Ğ¸Ğ»Ğ¸ component ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ. Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹: () "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" Ğ¸Ğ»Ğ¸ interface ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ. Ğ¡Ğ²ÑĞ·Ğ¸: --> (Ğ°ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ), ..> (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ), ..|> (Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ). Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ°: package, node, folder, frame, cloud, database. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam component, skinparam interface, skinparam package, skinparam arrow!';
        }
      } else if (diagramType === 'DeploymentPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'deployment-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ DeploymentPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ DEPLOYMENT PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. Ğ£Ğ·Ğ»Ñ‹: node "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" { [ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹] }. Ğ‘Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: database "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" { [ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹] }. ĞĞ±Ğ»Ğ°ĞºĞ°: cloud "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" { [ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹] }. Ğ¡Ğ²ÑĞ·Ğ¸: --> (Ğ°ÑÑĞ¾Ñ†Ğ¸Ğ°Ñ†Ğ¸Ñ), ..> (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑŒ). ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam node, skinparam database, skinparam component, skinparam arrow!';
        }
      } else if (diagramType === 'StatechartPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'statechart-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ StatechartPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ STATECHART PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ: [*] --> State1, State1 --> [*]. ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹: --> Ğ¸Ğ»Ğ¸ ->. Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²Ğ½Ñ‹Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ: state Name { ... } Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°Ğ¼Ğ¸ +2 ĞŸĞ ĞĞ‘Ğ•Ğ›Ğ Ğ´Ğ»Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾. Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ: [H] (Ğ½ĞµĞ´Ğ°Ğ²Ğ½ÑÑ), [H*] (Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ°Ñ). Ğ’ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ğµ/ÑĞ»Ğ¸ÑĞ½Ğ¸Ğµ: <<fork>>, <<join>>. Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ: <<choice>>. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam state, skinparam stateArrow, skinparam arrow!';
        }
      } else if (diagramType === 'GanttPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'gantt-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ GanttPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ GANTT PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startgantt ... @endgantt. Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸: [ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸] requires X days. Ğ”Ğ°Ñ‚Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ°: [ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸] starts YYYY-MM-DD. Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸: [Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 1] -> [Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 2]. Ğ’ĞµÑ…Ğ¸: [Ğ’ĞµÑ…Ğ°] happens YYYY-MM-DD. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam task, skinparam timeline, skinparam arrow!';
        }
      } else if (diagramType === 'ERPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'er-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ ERPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ ER PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startuml ... @enduml. Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚Ğ¸: entity "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ" as ĞĞ»Ğ¸Ğ°Ñ { * id : Ñ‚Ğ¸Ğ¿ -- Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚ : Ñ‚Ğ¸Ğ¿ }. Ğ¡Ğ²ÑĞ·Ğ¸: E1 ||--o{ E2 (Ğ¾Ğ´Ğ¸Ğ½ Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ Ğ¸Ğ»Ğ¸ ĞºĞ¾ Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğ¼), E1 }o--|| E2 (Ğ¼Ğ½Ğ¾Ğ³Ğ¸Ğµ Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ). ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· skinparam entity, skinparam arrow! ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ skinparam linetype ortho!';
        }
      } else if (diagramType === 'WBSPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'wbs-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ WBSPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ WBS PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startwbs ... @endwbs. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°: * ĞŸÑ€Ğ¾ĞµĞºÑ‚ ** Ğ¤Ğ°Ğ·Ğ° 1 *** Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 1.1 **** ĞŸĞ¾Ğ´Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° 1.1.1. Ğ—Ğ²ĞµĞ·Ğ´Ğ¾Ñ‡ĞºĞ¸ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¸ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ğ¸. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· <style> Ğ±Ğ»Ğ¾Ğº!';
        }
      } else if (diagramType === 'JSONPlantUML') {
        try {
          const instructionsPath = join(process.cwd(), 'prompts', 'json-plantuml-instructions.md');
          plantUmlInstructions = readFileSync(instructionsPath, 'utf-8');
        } catch (error) {
          console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¹ Ğ´Ğ»Ñ JSONPlantUML:', error);
          plantUmlInstructions = 'Ğ”Ğ›Ğ¯ JSON PLANTUML: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startjson ... @endjson. JSON Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ½Ñ‹Ğ¼ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°Ğ¼Ğ¸ (2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ° Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ²Ğ»Ğ¾Ğ¶ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸). Ğ’ÑĞµ ĞºĞ»ÑÑ‡Ğ¸ Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ² Ğ´Ğ²Ğ¾Ğ¹Ğ½Ñ‹Ñ… ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ…. ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞ¹ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ² (Ğ±ĞµĞ»Ñ‹Ğ¹, Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ÑĞµÑ€Ñ‹Ğ¹) Ñ‡ĞµÑ€ĞµĞ· <style> Ğ±Ğ»Ğ¾Ğº!';
        }
      }

      userPrompt = `Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹ ${typeDescription} Ğ´Ğ»Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ°/Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ°:

${objectDescription}

Ğ’ĞĞ–ĞĞ: Ğ’ÑĞµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ², ĞºĞ»Ğ°ÑÑĞ¾Ğ², Ğ¼ĞµÑ‚Ğ¾Ğ´Ğ¾Ğ², Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ² Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ñ€ÑƒÑÑĞºĞ¸Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑÑƒÑ‰Ğ½Ğ¾ÑÑ‚ĞµĞ¹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "Ğ˜Ğ½ÑÑ‚Ğ¸Ñ‚ÑƒÑ‚", "Ğ¡Ñ‚ÑƒĞ´ĞµĞ½Ñ‚", "ĞŸÑ€ĞµĞ¿Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ", "ĞšÑƒÑ€Ñ" Ğ¸ Ñ‚.Ğ´.). Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ PlantUML Ğ¾ÑÑ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ°Ğ½Ğ³Ğ»Ğ¸Ğ¹ÑĞºĞ¾Ğ¼ (class, interface, ->, etc.), Ğ½Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ - Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼.

${diagramType === 'MindMapPlantUML' || diagramType === 'SequencePlantUML' || diagramType === 'UseCasePlantUML' || diagramType === 'ActivityPlantUML' || diagramType === 'ClassPlantUML' || diagramType === 'ObjectPlantUML' || diagramType === 'ComponentPlantUML' || diagramType === 'DeploymentPlantUML' || diagramType === 'StatechartPlantUML' || diagramType === 'GanttPlantUML' || diagramType === 'ERPlantUML' || diagramType === 'WBSPlantUML' || diagramType === 'JSONPlantUML' ? plantUmlInstructions : ''}
${diagramType === 'MindMap' ? 'Ğ”Ğ›Ğ¯ MINDMAP: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ @startmindmap ... @endmindmap. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°: * Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚ĞµĞ¼Ğ° ** ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1 *** ĞŸĞ¾Ğ´Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1.1 ** ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2. ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ "mindmap" Ğ±ĞµĞ· @startmindmap/@endmindmap!' : ''}
${diagramType === 'Activity' ? 'Ğ”Ğ›Ğ¯ ACTIVITY: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ activity Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹: start, :Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ;, if (ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğµ) then, else, endif, fork, fork again, end fork, stop. ĞĞ• Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ split/join, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ fork/fork again/end fork!' : ''}
${diagramType === 'Class' ? 'Ğ”Ğ›Ğ¯ CLASS: Ğ”Ğ»Ñ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ñ€ÑƒÑÑĞºĞ¸Ñ… Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹ ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ±Ğ¸Ğ²Ğ°Ğ¹ Ğ½Ğ° Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ ÑĞ»Ğ¾Ğ². ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: "Ğ¤ĞµĞ´ĞµÑ€Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ“Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğµ ĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ£Ñ‡Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ" Ğ²Ğ¼ĞµÑÑ‚Ğ¾ "Ğ¤ĞµĞ´ĞµÑ€Ğ°Ğ»ÑŒĞ½Ğ¾ĞµĞ“Ğ¾ÑÑƒĞ´Ğ°Ñ€ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ĞµĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ĞµĞ£Ñ‡Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ". Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸ Ğ´Ğ»Ñ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ñ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°Ğ¼Ğ¸: class "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°Ğ¼Ğ¸" as ĞĞ»Ğ¸Ğ°Ñ' : ''}`;

      if (context) {
        userPrompt += `\n\nĞ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ· Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²:\n${context.substring(0, 3000)}`;
      }

      userPrompt += `\n\nĞ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ ĞºĞ¾Ğ´ PlantUML Ğ¸ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:
\`\`\`plantuml
${diagramType === 'MindMapPlantUML' ? '@startmindmap' : diagramType === 'GanttPlantUML' ? '@startgantt' : diagramType === 'WBSPlantUML' ? '@startwbs' : diagramType === 'JSONPlantUML' ? '@startjson' : diagramType === 'SequencePlantUML' || diagramType === 'UseCasePlantUML' || diagramType === 'ClassPlantUML' || diagramType === 'ActivityPlantUML' || diagramType === 'ObjectPlantUML' || diagramType === 'ComponentPlantUML' || diagramType === 'DeploymentPlantUML' || diagramType === 'StatechartPlantUML' ? '@startuml' : '@startuml'}
[ĞºĞ¾Ğ´ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹ Ñ Ñ€ÑƒÑÑĞºĞ¸Ğ¼Ğ¸ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑĞ¼Ğ¸ Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğ¾Ğ²]
${diagramType === 'MindMapPlantUML' ? '@endmindmap' : diagramType === 'GanttPlantUML' ? '@endgantt' : diagramType === 'WBSPlantUML' ? '@endwbs' : diagramType === 'JSONPlantUML' ? '@endjson' : '@enduml'}
\`\`\`

\`\`\`json
[
  {"element": "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼", "description": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ° Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼"},
  ...
]
\`\`\``;
    }

    try {
      // Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Mistral AI
      const chatResponse = await client.chat.complete({
        model: 'pixtral-12b-2409',
        messages: [
          {
            role: 'system',
            content: systemPrompt,
          },
          {
            role: 'user',
            content: userPrompt,
          },
        ],
        maxTokens: 4096,
        temperature: 0.3, // ĞĞ¸Ğ·ĞºĞ°Ñ Ñ‚ĞµĞ¼Ğ¿ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ĞµĞµ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°
      });

      const responseContent = chatResponse.choices?.[0]?.message?.content;
      let responseText = '';
      if (typeof responseContent === 'string') {
        responseText = responseContent;
      } else if (Array.isArray(responseContent)) {
        responseText = responseContent
          .map(c => {
            if (typeof c === 'string') return c;
            if ('text' in c && typeof (c as any).text === 'string') return (c as any).text;
            return '';
          })
          .join('');
      } else {
        responseText = String(responseContent || '');
      }

      // Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ² Ğ² MindMap
      const fixMindMapIndentation = (code: string): string => {
        const lines = code.split('\n').map(l => l.trimEnd());
        if (lines.length === 0) return 'mindmap\n  root((ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»))';
        
        const result: string[] = [];
        
        // ĞŸĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ "mindmap" Ğ±ĞµĞ· Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ²
        const firstLine = lines[0].trim();
        if (firstLine.toLowerCase() === 'mindmap' || firstLine === '') {
          result.push('mindmap');
        } else {
          result.push('mindmap');
          // Ğ•ÑĞ»Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ½Ğµ "mindmap", Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞµĞµ ĞºĞ°Ğº ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»
          if (firstLine) {
            const rootContent = firstLine.replace(/^root\(\(|\)\)$/g, '').trim();
            result.push(`  root((${rootContent || 'ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»'}))`);
          }
        }
        
        // ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»
        let rootFound = false;
        let rootContent = '';
        let startIndex = 1;
        
        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;
          
          if (line.startsWith('root')) {
            rootContent = line.replace(/^root\(\(|\)\)$/g, '').trim();
            rootFound = true;
            startIndex = i + 1;
            break;
          } else if (!rootFound) {
            // ĞŸĞµÑ€Ğ²Ğ°Ñ Ğ½ĞµĞ¿ÑƒÑÑ‚Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ¿Ğ¾ÑĞ»Ğµ mindmap - ÑÑ‚Ğ¾ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»
            rootContent = line.replace(/^root\(\(|\)\)$/g, '').trim();
            rootFound = true;
            startIndex = i + 1;
            break;
          }
        }
        
        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»
        if (rootFound && rootContent) {
          result.push(`  root((${rootContent}))`);
        } else if (!rootFound) {
          result.push('  root((ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»))');
        }
        
        // ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ - Ğ²ÑĞµ Ğ¾Ğ½Ğ¸ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ñ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ (>= 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)
        const contentLines: string[] = [];
        for (let i = startIndex; i < lines.length; i++) {
          const line = lines[i].trim();
          if (line && !line.startsWith('root')) {
            contentLines.push(line);
          }
        }
        
        // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ±ĞµĞ· Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ² Ğ¸Ğ»Ğ¸ Ñ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¼Ğ¸ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°Ğ¼Ğ¸ - ÑÑ‚Ğ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)
        // Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼Ğ¸ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ°Ğ¼Ğ¸ - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ
        let baseIndent = 4;
        for (const line of contentLines) {
          const originalLine = lines.find(l => l.trim() === line);
          if (originalLine) {
            const leadingSpaces = originalLine.length - originalLine.trimStart().length;
            if (leadingSpaces <= 2) {
              // Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ° Ğ±ĞµĞ· Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ° Ğ¸Ğ»Ğ¸ Ñ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¼ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ - ÑÑ‚Ğ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ
              result.push(`    ${line}`);
            } else {
              // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿, Ğ½Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼
              // ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°, ĞºÑ€Ğ°Ñ‚Ğ½Ğ¾ 2
              const normalizedIndent = Math.max(4, Math.ceil((leadingSpaces - 2) / 2) * 2 + 2);
              result.push(' '.repeat(normalizedIndent) + line);
            }
          } else {
            // Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ¸ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ ÑÑ‚Ñ€Ğ¾ĞºÑƒ, Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¼ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼
            result.push(' '.repeat(baseIndent) + line);
          }
        }
        
        return result.join('\n');
      };

      // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ¸ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ° Mermaid
      const fixMermaidCode = (code: string, diagramType: string): string => {
        let fixed = code.trim();
        
        // Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ´Ğ»Ñ MindMap
        if (diagramType === 'mindmap') {
          // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²ÑĞµ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ñ‹ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ Ğ¸ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼
          const lines = fixed.split('\n');
          const normalized: string[] = [];
          
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            
            if (i === 0) {
              // ĞŸĞµÑ€Ğ²Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ° Ğ±Ñ‹Ñ‚ÑŒ "mindmap"
              normalized.push('mindmap');
            } else if (i === 1) {
              // Ğ’Ñ‚Ğ¾Ñ€Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° - ĞºĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ» Ñ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ 2 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°
              if (line.startsWith('root')) {
                normalized.push(`  ${line}`);
              } else {
                normalized.push(`  root((${line.replace(/^root\(\(|\)\)$/g, '')}))`);
              }
            } else {
              // ĞÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ - Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¸
              const prevLine = normalized[normalized.length - 1];
              const prevIndent = prevLine.length - prevLine.trimStart().length;
              
              // Ğ•ÑĞ»Ğ¸ Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ ÑÑ‚Ñ€Ğ¾ĞºĞ° Ğ±ĞµĞ· Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ° Ğ¸Ğ»Ğ¸ Ñ Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¼ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ - ÑÑ‚Ğ¾ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ (4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°)
              const leadingSpaces = lines[i].length - lines[i].trimStart().length;
              if (leadingSpaces <= 2) {
                normalized.push(`    ${line}`); // 4 Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°
              } else {
                // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¾Ñ‚Ğ½Ğ¾ÑĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿, Ğ½Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµĞ¼ Ğ´Ğ¾ Ñ‡ĞµÑ‚Ğ½Ñ‹Ñ… Ñ‡Ğ¸ÑĞµĞ»
                const normalizedIndent = Math.max(4, Math.ceil((leadingSpaces - 2) / 2) * 2 + 2);
                normalized.push(' '.repeat(normalizedIndent) + line);
              }
            }
          }
          
          fixed = normalized.join('\n');
        } else {
          // Ğ”Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼
          // Ğ£Ğ±ĞµĞ¶Ğ´Ğ°ĞµĞ¼ÑÑ, Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ´ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
          if (!fixed.startsWith(diagramType)) {
            // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµÑ„Ğ¸ĞºÑÑ‹ Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹
            fixed = fixed.replace(/^(flowchart|graph|mindmap|sequenceDiagram|classDiagram|stateDiagram|erDiagram|gantt|pie|quadrantChart|radar|journey|xychart|gitGraph|kanban|C4Context|C4Container)\s*/i, '');
            fixed = `${diagramType}\n${fixed}`;
          }
          
          // Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ€Ğ°ÑĞ¿Ñ€Ğ¾ÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
          // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ñ‹ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ ÑÑ‚Ñ€Ğ¾Ğº
          fixed = fixed.split('\n').map(line => line.trimStart()).join('\n');
          
          // Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½ĞµĞ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ² flowchart/graph (Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‰Ğ¸Ğµ ÑĞºĞ¾Ğ±ĞºĞ¸ Ğ´Ğ»Ñ ÑƒĞ·Ğ»Ğ¾Ğ²)
          if (diagramType.startsWith('flowchart') || diagramType.startsWith('graph')) {
            // Ğ£Ğ±ĞµĞ¶Ğ´Ğ°ĞµĞ¼ÑÑ, Ñ‡Ñ‚Ğ¾ ÑƒĞ·Ğ»Ñ‹ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ Ğ·Ğ°ĞºÑ€Ñ‹Ñ‚Ñ‹
            fixed = fixed.replace(/(\[[^\]]*)$/gm, (match) => {
              if (!match.includes(']')) {
                return match + ']';
              }
              return match;
            });
            fixed = fixed.replace(/(\{[^\}]*)$/gm, (match) => {
              if (!match.includes('}')) {
                return match + '}';
              }
              return match;
            });
          }
        }
        
        // Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ğ¼Ğ¸ Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸ÑÑ…
        // Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ¸ Ğ½Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ
        fixed = fixed.replace(/[""]/g, '"').replace(/['']/g, "'");
        
        // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¿ÑƒÑÑ‚Ñ‹Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğµ Ğ¸ ĞºĞ¾Ğ½Ñ†Ğµ
        fixed = fixed.trim();
        
        return fixed;
      };

      // Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ ĞºĞ¾Ğ´ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ° Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹
      if (isMermaid) {
        // Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ ĞºĞ¾Ğ´ Mermaid
        const mermaidMatch = responseText.match(/```mermaid\s*\n([\s\S]*?)\n```/i) ||
                           responseText.match(new RegExp(`${mermaidDiagramType}\\s*\\n([\\s\\S]*?)(?=\\n\`\`\`|$)`, 'i'));
        
        let mermaidCode = '';
        if (mermaidMatch) {
          mermaidCode = mermaidMatch[1].trim();
          
          // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ´Ğ»Ñ Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº
          mermaidCode = fixMermaidCode(mermaidCode, mermaidDiagramType);
          
          // Ğ”Ğ»Ñ MindMap Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğ¾Ñ‚ÑÑ‚ÑƒĞ¿Ğ¾Ğ²
          if (mermaidDiagramType === 'mindmap' && (diagramType === 'MindMapMax' || diagramType === 'MindMapMermaid')) {
            mermaidCode = fixMindMapIndentation(mermaidCode);
          }
        } else {
          // Fallback: ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Mermaid Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ°
          if (mermaidDiagramType === 'mindmap') {
            const rootNode = objectDescription.split(' ')[0] || 'ĞšĞ¾Ñ€Ğ½ĞµĞ²Ğ¾Ğ¹ ÑƒĞ·ĞµĞ»';
            mermaidCode = `mindmap
  root((${rootNode}))
    ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1
      Ğ”ĞµÑ‚Ğ°Ğ»ÑŒ 1.1
    ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2
      Ğ”ĞµÑ‚Ğ°Ğ»ÑŒ 2.1`;
          } else if (mermaidDiagramType === 'flowchart' || mermaidDiagramType === 'graph') {
            const nodeName = objectDescription.split(' ')[0] || 'Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚';
            mermaidCode = `${mermaidDiagramType} TD
    A[${nodeName}]
    B[ĞŸĞ¾Ğ´ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ 1]
    C[ĞŸĞ¾Ğ´ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚ 2]
    A --> B
    A --> C`;
          } else if (mermaidDiagramType === 'pie') {
            mermaidCode = `pie title ${objectDescription.split(' ')[0] || 'Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°'}
    "Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ 1" : 30
    "Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ 2" : 50
    "Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚ 3" : 20`;
          } else {
            mermaidCode = `${mermaidDiagramType}\n    ${objectDescription.split(' ')[0] || 'Ğ­Ğ»ĞµĞ¼ĞµĞ½Ñ‚'}`;
          }
          
          // ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºÑƒ Ğº fallback ĞºĞ¾Ğ´Ñƒ
          mermaidCode = fixMermaidCode(mermaidCode, mermaidDiagramType);
        }

        // Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹
        const glossaryMatch = responseText.match(/```json\s*\n([\s\S]*?)\n```/i);
        let glossary: Array<{ element: string; description: string }> = [];
        
        if (glossaryMatch) {
          try {
            glossary = JSON.parse(glossaryMatch[1]);
          } catch (e) {
            console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ñ:', e);
            glossary = [{ element: objectDescription, description: 'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹' }];
          }
        } else {
          glossary = [{ element: objectDescription, description: 'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹' }];
        }

        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ñ
        if (!Array.isArray(glossary)) {
          glossary = [{ element: objectDescription, description: 'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹' }];
        }

        return NextResponse.json({
          mermaidCode,
          glossary,
        });
      } else {
        // Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ ĞºĞ¾Ğ´ PlantUML
        // Ğ”Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼ Ğ½ÑƒĞ¶Ğ½Ñ‹ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸
        const isMindMap = diagramType === 'MindMap' || diagramType === 'MindMapPlantUML';
        const isGanttPlantUML = diagramType === 'GanttPlantUML';
        const isWBSPlantUML = diagramType === 'WBSPlantUML';
        const isJSONPlantUML = diagramType === 'JSONPlantUML';
        const isSequencePlantUML = diagramType === 'SequencePlantUML';
        const isUseCasePlantUML = diagramType === 'UseCasePlantUML';
        const isClassPlantUML = diagramType === 'ClassPlantUML';
        const isStatechartPlantUML = diagramType === 'StatechartPlantUML';
        const isJSON = diagramType === 'JSON';
        
        const startTag = isMindMap ? '@startmindmap' : (isGanttPlantUML ? '@startgantt' : (isWBSPlantUML ? '@startwbs' : (isJSONPlantUML ? '@startjson' : (isJSON ? '@startjson' : '@startuml'))));
        const endTag = isMindMap ? '@endmindmap' : (isGanttPlantUML ? '@endgantt' : (isWBSPlantUML ? '@endwbs' : (isJSONPlantUML ? '@endjson' : (isJSON ? '@endjson' : '@enduml'))));
        
        const plantUmlMatch = responseText.match(/```plantuml\s*\n([\s\S]*?)\n```/i) || 
                             responseText.match(new RegExp(`${startTag}\\s*\\n([\\s\\S]*?)${endTag}`, 'i')) ||
                             responseText.match(/@startuml\s*\n([\s\S]*?)@enduml/i);
        
        let plantUmlCode = '';
        if (plantUmlMatch) {
          plantUmlCode = plantUmlMatch[1].trim();
          
          // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ½ĞµĞ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ĞµÑÑ‚ÑŒ
          plantUmlCode = plantUmlCode.replace(/@startuml\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@enduml\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@startmindmap\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@endmindmap\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@startjson\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@endjson\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@startgantt\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@endgantt\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@startwbs\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@endwbs\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@startjson\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/@endjson\s*/gi, '');
          plantUmlCode = plantUmlCode.replace(/mindmap\s*/gi, ''); // Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ "mindmap" ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ
          plantUmlCode = plantUmlCode.replace(/split\s*/gi, 'fork'); // Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ split Ğ½Ğ° fork Ğ´Ğ»Ñ Activity
          plantUmlCode = plantUmlCode.replace(/join\s*/gi, 'end fork'); // Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ join Ğ½Ğ° end fork Ğ´Ğ»Ñ Activity
          
          // Ğ”Ğ»Ñ MindMapPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'MindMapPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('<style>')) {
              const styleBlock = `<style>
mindmapDiagram {
  node {
    BackgroundColor white
    FontColor black
    LineColor #000000
    BorderColor #000000
  }
  rootNode {
    BackgroundColor white
    FontColor black
    LineColor #000000
    BorderColor #000000
  }
  leafNode {
    BackgroundColor white
    FontColor black
    LineColor #666666
    BorderColor #666666
  }
  arrow {
    LineColor #000000
  }
}
</style>
`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ SequencePlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'SequencePlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam sequence')) {
              const styleBlock = `skinparam sequence {
  ArrowColor #000000
  ActorBorderColor #000000
  ActorBackgroundColor #FFFFFF
  ParticipantBorderColor #000000
  ParticipantBackgroundColor #FFFFFF
  LifeLineBorderColor #666666
  LifeLineBackgroundColor #FFFFFF
  NoteBorderColor #666666
  NoteBackgroundColor #F5F5F5
  NoteTextColor #000000
  BoxBorderColor #000000
  BoxBackgroundColor #FFFFFF
  TextAlignmentMessage #000000
  TextAlignmentLifeLine #000000
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ UseCasePlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'UseCasePlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam usecase')) {
              const styleBlock = `skinparam usecase {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
}
skinparam actor {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
}
skinparam rectangle {
  BackgroundColor #FFFFFF
  BorderColor #666666
  FontColor #000000
}
skinparam arrow {
  Color #000000
}
skinparam note {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ Class Ğ¸ ClassPlantUML: Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ±ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ¾Ğ²
          if (diagramType === 'Class' || diagramType === 'ClassPlantUML') {
            // Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ ÑĞ»Ğ¸Ñ‚Ğ½Ñ‹Ğµ Ñ€ÑƒÑÑĞºĞ¸Ğµ ÑĞ»Ğ¾Ğ²Ğ° Ğ½Ğ° ÑĞ»Ğ¾Ğ²Ğ° Ñ Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»Ğ°Ğ¼Ğ¸ Ğ² ĞºĞ°Ğ²Ñ‹Ñ‡ĞºĞ°Ñ…
            plantUmlCode = plantUmlCode.replace(/class\s+([Ğ-Ğ¯Ğ][Ğ°-ÑÑ‘]{20,})\s+as\s+(\w+)/gi, (match, className, alias) => {
              // Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾ Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ğ¸ (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 15-20 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
              const words = className.match(/.{1,20}/g);
              const spacedName = words ? words.join(' ') : className;
              return `class "${spacedName}" as ${alias}`;
            });
            // Ğ¢Ğ°ĞºĞ¶Ğµ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ»ÑƒÑ‡Ğ°Ğ¸ Ğ±ĞµĞ· "as"
            plantUmlCode = plantUmlCode.replace(/class\s+([Ğ-Ğ¯Ğ][Ğ°-ÑÑ‘]{20,})\s*{/gi, (match, className) => {
              const words = className.match(/.{1,20}/g);
              const spacedName = words ? words.join(' ') : className;
              return `class "${spacedName}" {`;
            });
          }
          
          // Ğ”Ğ»Ñ ClassPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'ClassPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam class')) {
              const styleBlock = `skinparam class {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
  ArrowColor #000000
  AttributeFontColor #000000
  MethodFontColor #000000
  StereotypeFontColor #000000
}
skinparam package {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
  TitleFontColor #000000
}
skinparam interface {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
  StereotypeFontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}
skinparam note {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ ObjectPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'ObjectPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam object')) {
              const styleBlock = `skinparam backgroundColor white
skinparam object {
  BackgroundColor white
  FontColor black
  BorderColor #000000
  ArrowColor #000000
}
skinparam objectArrowColor #000000

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ ComponentPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'ComponentPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam component')) {
              const styleBlock = `skinparam component {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
  ArrowColor #000000
}
skinparam interface {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam package {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
  TitleFontColor #000000
}
skinparam node {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam folder {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam frame {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam cloud {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam database {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}
skinparam note {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ DeploymentPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'DeploymentPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam node') || !plantUmlCode.includes('skinparam backgroundColor')) {
              const styleBlock = `skinparam backgroundColor white
skinparam node {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam database {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam component {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam artifact {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam cloud {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam folder {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam frame {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam package {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam storage {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}
skinparam note {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ StatechartPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'StatechartPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam state') || !plantUmlCode.includes('BackgroundColor')) {
              const styleBlock = `skinparam state {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
  ArrowColor #000000
}
skinparam stateBody {
  BackgroundColor #FFFFFF
  BorderColor #000000
}
skinparam stateArrow {
  Color #000000
}
skinparam arrow {
  Color #000000
  FontColor #000000
}
skinparam note {
  BackgroundColor #F5F5F5
  BorderColor #666666
  FontColor #000000
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ GanttPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'GanttPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam task') || !plantUmlCode.includes('BackgroundColor')) {
              const styleBlock = `skinparam backgroundColor white
skinparam task {
  BackgroundColor white
  FontColor black
  BorderColor #000000
}
skinparam taskArrow {
  Color #000000
}
skinparam timeline {
  BackgroundColor white
  FontColor black
  LineColor #666666
  GridColor #E5E5E5
}
skinparam milestone {
  BackgroundColor white
  FontColor black
  BorderColor #000000
}
skinparam arrow {
  Color #000000
}
skinparam title {
  BackgroundColor white
  FontColor black
}

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ ERPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'ERPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('skinparam entity') || !plantUmlCode.includes('BackgroundColor')) {
              const styleBlock = `skinparam linetype ortho
skinparam backgroundColor white
skinparam entity {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}
skinparam arrowFontColor #000000

`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ WBSPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'WBSPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('<style>')) {
              const styleBlock = `<style>
wbsDiagram {
  BackgroundColor white
  LineColor black
  FontColor black
}
node {
  BackgroundColor white
  FontColor black
  LineColor #000000
  BorderColor #000000
  Padding 8
  Margin 3
}
rootNode {
  BackgroundColor white
  FontColor black
  LineColor #000000
  BorderColor #000000
  LineThickness 2.0
  Padding 12
  Margin 5
}
leafNode {
  BackgroundColor white
  FontColor black
  LineColor #666666
  BorderColor #666666
  Padding 6
  Margin 2
}
arrow {
  LineColor #000000
  LineThickness 1.0
}
</style>
`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ»Ñ JSONPlantUML: Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ñ… Ñ†Ğ²ĞµÑ‚Ğ¾Ğ², ĞµÑĞ»Ğ¸ Ğ¸Ñ… Ğ½ĞµÑ‚
          if (diagramType === 'JSONPlantUML') {
            // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, ĞµÑÑ‚ÑŒ Ğ»Ğ¸ ÑƒĞ¶Ğµ ÑÑ‚Ğ¸Ğ»Ğ¸
            if (!plantUmlCode.includes('<style>')) {
              const styleBlock = `<style>
jsonDiagram {
  node {
    BackGroundColor white
    FontColor black
    LineColor #000000
    BorderColor #000000
    FontName Helvetica
    FontSize 12
    FontStyle normal
    RoundCorner 0
    LineThickness 1
    LineStyle 1-0
    separator {
      LineThickness 0.5
      LineColor #666666
      LineStyle 1-0
    }
  }
  arrow {
    BackGroundColor #F5F5F5
    LineColor #000000
    LineThickness 1
    LineStyle 1-0
  }
  highlight {
    BackGroundColor #E5E5E5
    FontColor black
    FontStyle normal
  }
}
</style>
`;
              // Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ² Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ¾ ĞºĞ¾Ğ´Ğ° (Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ñ‹Ğ¼)
              plantUmlCode = styleBlock + plantUmlCode;
            }
          }
          
          // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµĞ³Ğ¸
          if (!plantUmlCode.includes(startTag)) {
            plantUmlCode = `${startTag}\n` + plantUmlCode;
          }
          if (!plantUmlCode.includes(endTag)) {
            plantUmlCode = plantUmlCode + `\n${endTag}`;
          }
        } else {
          // Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ½Ğ°ÑˆĞ»Ğ¸ Ğ² markdown, Ğ¸Ñ‰ĞµĞ¼ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ
          const startIndex = responseText.indexOf(startTag);
          const endIndex = responseText.indexOf(endTag);
          if (startIndex !== -1 && endIndex !== -1) {
            plantUmlCode = responseText.substring(startIndex, endIndex + endTag.length).trim();
          } else {
            // Fallback: ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²ÑƒÑ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñƒ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ°
            if (isMindMap) {
              plantUmlCode = `${startTag}
* ${objectDescription.split(' ')[0]}
** ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 1
*** Ğ”ĞµÑ‚Ğ°Ğ»ÑŒ 1.1
** ĞŸĞ¾Ğ´Ñ‚ĞµĞ¼Ğ° 2
${endTag}`;
            } else if (isSequencePlantUML) {
              plantUmlCode = `${startTag}
skinparam sequence {
  ArrowColor #000000
  ActorBorderColor #000000
  ActorBackgroundColor #FFFFFF
  ParticipantBorderColor #000000
  ParticipantBackgroundColor #FFFFFF
  LifeLineBorderColor #666666
  LifeLineBackgroundColor #FFFFFF
  NoteBorderColor #666666
  NoteBackgroundColor #F5F5F5
  NoteTextColor #000000
}

participant "Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸Ğº 1" as P1
participant "Ğ£Ñ‡Ğ°ÑÑ‚Ğ½Ğ¸Ğº 2" as P2
P1 -> P2: Ğ¡Ğ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
${endTag}`;
            } else if (isUseCasePlantUML) {
              plantUmlCode = `${startTag}
skinparam usecase {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
}
skinparam actor {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
}
skinparam rectangle {
  BackgroundColor #FFFFFF
  BorderColor #666666
  FontColor #000000
}
skinparam arrow {
  Color #000000
}

actor "ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ" as User
(Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
User --> (Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
${endTag}`;
            } else if (isClassPlantUML) {
              plantUmlCode = `${startTag}
skinparam class {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
  ArrowColor #000000
  AttributeFontColor #000000
  MethodFontColor #000000
}
skinparam arrow {
  Color #000000
}

class "${objectDescription.split(' ')[0]}" {
  +Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚: String
  +Ğ¼ĞµÑ‚Ğ¾Ğ´(): void
}
${endTag}`;
            } else if (isStatechartPlantUML) {
              plantUmlCode = `${startTag}
skinparam state {
  BackgroundColor #FFFFFF
  BorderColor #000000
  FontColor #000000
  ArrowColor #000000
}
skinparam stateBody {
  BackgroundColor #FFFFFF
  BorderColor #000000
}
skinparam stateArrow {
  Color #000000
}
skinparam arrow {
  Color #000000
  FontColor #000000
}

[*] --> ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ : ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ
ĞĞ°Ñ‡Ğ°Ğ»ÑŒĞ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ --> ĞŸÑ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ : Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ1
ĞŸÑ€Ğ¾Ğ¼ĞµĞ¶ÑƒÑ‚Ğ¾Ñ‡Ğ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ --> ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ : Ğ¡Ğ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ2
ĞšĞ¾Ğ½ĞµÑ‡Ğ½Ğ¾ĞµĞ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ --> [*]
${endTag}`;
            } else if (isGanttPlantUML) {
              plantUmlCode = `${startTag}
skinparam backgroundColor white
skinparam task {
  BackgroundColor white
  FontColor black
  BorderColor #000000
}
skinparam taskArrow {
  Color #000000
}
skinparam timeline {
  BackgroundColor white
  FontColor black
  LineColor #666666
  GridColor #E5E5E5
}
skinparam milestone {
  BackgroundColor white
  FontColor black
  BorderColor #000000
}
skinparam arrow {
  Color #000000
}
skinparam title {
  BackgroundColor white
  FontColor black
}
Project starts 2024-01-01
[${objectDescription.split(' ')[0]}] requires 5 days
[${objectDescription.split(' ')[0]}] starts 2024-01-01
${endTag}`;
            } else if (diagramType === 'ComponentPlantUML') {
              plantUmlCode = `${startTag}
skinparam component {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
  ArrowColor #000000
}
skinparam interface {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}

[${objectDescription.split(' ')[0]}]
[ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ 2]
() "Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ" as Interf1
[${objectDescription.split(' ')[0]}] --> [ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ 2]
[${objectDescription.split(' ')[0]}] ..> Interf1 : use
${endTag}`;
            } else if (diagramType === 'DeploymentPlantUML') {
              plantUmlCode = `${startTag}
skinparam backgroundColor white
skinparam node {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam database {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam component {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}

node "Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹" {
  [${objectDescription.split(' ')[0]}] as App
}
database "Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…" {
  [PostgreSQL] as DB
}
App --> DB
${endTag}`;
            } else if (diagramType === 'ERPlantUML') {
              plantUmlCode = `${startTag}
skinparam linetype ortho
skinparam backgroundColor white
skinparam entity {
  BackgroundColor white
  BorderColor #000000
  FontColor #000000
}
skinparam arrow {
  Color #000000
  Thickness 1
}
skinparam arrowFontColor #000000

entity "${objectDescription.split(' ')[0]}" as E1 {
  * id : INT
  --
  Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ : STRING
  Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ : TEXT
}

entity "Ğ¡ÑƒÑ‰Ğ½Ğ¾ÑÑ‚ÑŒ2" as E2 {
  * id : INT
  e1_id : INT
  --
  Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ : STRING
}

E1 ||--o{ E2 : "Ğ¸Ğ¼ĞµĞµÑ‚"
${endTag}`;
            } else if (diagramType === 'WBSPlantUML') {
              plantUmlCode = `${startTag}
<style>
wbsDiagram {
  BackgroundColor white
  LineColor black
  FontColor black
}
node {
  BackgroundColor white
  FontColor black
  LineColor #000000
  BorderColor #000000
  Padding 8
  Margin 3
}
rootNode {
  BackgroundColor white
  FontColor black
  LineColor #000000
  BorderColor #000000
  LineThickness 2.0
  Padding 12
  Margin 5
}
leafNode {
  BackgroundColor white
  FontColor black
  LineColor #666666
  BorderColor #666666
  Padding 6
  Margin 2
}
arrow {
  LineColor #000000
  LineThickness 1.0
}
</style>
* ${objectDescription.split(' ')[0]}
** Ğ¤Ğ°Ğ·Ğ° 1
*** Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 1.1
** Ğ¤Ğ°Ğ·Ğ° 2
*** Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ° 2.1
${endTag}`;
            } else if (diagramType === 'JSONPlantUML') {
              plantUmlCode = `${startTag}
<style>
jsonDiagram {
  node {
    BackGroundColor white
    FontColor black
    LineColor #000000
    BorderColor #000000
    FontName Helvetica
    FontSize 12
    FontStyle normal
    RoundCorner 0
    LineThickness 1
    LineStyle 1-0
    separator {
      LineThickness 0.5
      LineColor #666666
      LineStyle 1-0
    }
  }
  arrow {
    BackGroundColor #F5F5F5
    LineColor #000000
    LineThickness 1
    LineStyle 1-0
  }
  highlight {
    BackGroundColor #E5E5E5
    FontColor black
    FontStyle normal
  }
}
</style>
{
  "Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ": "${objectDescription.split(' ')[0]}",
  "Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ": "${objectDescription.substring(0, 50)}",
  "Ñ‚Ğ¸Ğ¿": "Ğ¾Ğ±ÑŠĞµĞºÑ‚",
  "ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°": {
    "ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾1": "Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ1",
    "ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ¾2": "Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ2"
  },
  "Ğ¼Ğ°ÑÑĞ¸Ğ²": [
    "ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚1",
    "ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚2",
    "ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚3"
  ]
}
${endTag}`;
            } else {
              plantUmlCode = `${startTag}
class ${objectDescription.split(' ')[0]} {
  + Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
}
${endTag}`;
            }
          }
        }

        // Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµĞ¼ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹
        const glossaryMatch = responseText.match(/```json\s*\n([\s\S]*?)\n```/i);
        let glossary: Array<{ element: string; description: string }> = [];
        
        if (glossaryMatch) {
          try {
            glossary = JSON.parse(glossaryMatch[1]);
          } catch (e) {
            console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ñ:', e);
            // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ ĞºĞ¾Ğ´Ğ°
            glossary = [{ element: objectDescription, description: 'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹' }];
          }
        } else {
          // Ğ•ÑĞ»Ğ¸ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ğ¹ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½, ÑĞ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ±Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹
          glossary = [{ element: objectDescription, description: 'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹' }];
        }

        // Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ³Ğ»Ğ¾ÑÑĞ°Ñ€Ğ¸Ñ
        if (!Array.isArray(glossary)) {
          glossary = [{ element: objectDescription, description: 'ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹' }];
        }

        return NextResponse.json({
          plantUmlCode,
          glossary,
        });
      }
    } catch (apiError) {
      console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ Mistral AI API:', apiError);
      return NextResponse.json(
        { error: `ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹: ${apiError instanceof Error ? apiError.message : 'ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°'}` },
        { status: 500 }
      );
    }
  } catch (error) {
    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹:', error);
    return NextResponse.json(
      { error: error instanceof Error ? error.message : 'ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°' },
      { status: 500 }
    );
  }
}

